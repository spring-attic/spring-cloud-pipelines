// Do not edit this file (e.g. go instead to docs/)
:jenkins-root-docs: https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs/img/jenkins
:demo-root-docs: https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs/img/demo
:concourse-root-docs: https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs/img/concourse
:intro-root-docs: https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs/img/intro
:toc:
= SCRIPTS

pipeline.sh(1)
==============
:compat-mode!:

NAME
----
pipeline.sh - a shell script

SYNOPSIS
--------

Contains interfaces for all essential functions for different
steps of deployment pipeline.

Sources:
- projectType/pipeline-projectType.sh
- pipeline-${paasType}.sh (e.g. pipeline-cf.sh)
- custom/${scriptName}.sh (e.g. custom/build_and_upload.sh)

Essentially, the scripts implementing the functions can be divided
into 2 types.

1) Build related
2) Deployment related

The build related scripts need to define how to build an application.
E.g. for Java we're using Maven or Gradle to build a project. For other
languages other frameworks and approaches would be applicable. You can
arbitrarily chose the language type via the LANGUAGE_TYPE env variable
or via the language_type pipeline descriptor entry. That value, via convention,
gets applied to the string [projectType/pipeline-${languageType}.sh] that
represents a file that we will source in order to apply all the build functions.
The deployment related scripts need to define how to upload the application.
For Java and Cloud Foundry we're using the CF CLI to push the binary
to PAAS. For NPM we're pushing sources. You can
arbitrarily chose the platform type via the PAAS_TYPE env variable That value,
via convention, gets applied to the string [pipeline-${paasType}.sh]
that represents a file that we will source in order to apply all the deployment functions.


FUNCTIONS
---------

 apiCompatibilityCheck
 build
 completeSwitchOver
 defineProjectSetup
 deleteService
 deployService
 deployServices
 envNodeExists
 executeApiCompatibilityCheck
 extractVersionFromProdTag
 findLatestProdTag
 getMainModulePath
 latestProdTagFromGit
 outputFolder
 parsePipelineDescriptor
 prepareForE2eTests
 prepareForSmokeTests
 prodDeploy
 projectType
 removeProdTag
 retrieveAppName
 retrieveGroupId
 retrieveStubRunnerIds
 rollbackToPreviousVersion
 runE2eTests
 runSmokeTests
 serviceExists
 stageDeploy
 testDeploy
 testResultsAntPattern
 testRollbackDeploy
 toLowerCase
 trimRefsTag
 yaml2json

DETAILS
-------

Script Body
~~~~~~~~~~~

Has 49 line(s). Calls functions:

 Script-Body
 |-- defineProjectSetup
 |   `-- parsePipelineDescriptor
 `-- parsePipelineDescriptor

Uses feature(s): _export_, _source_

_Exports (environment):_ BINARY_ARTIFACT_TYPE_NAME [big]*//* CUSTOM_SCRIPT_IDENTIFIER [big]*//* DEFAULT_PROJECT_NAME [big]*//* DOWNLOADABLE_SOURCES [big]*//* GIT_BIN [big]*//* LANGUAGE_TYPE [big]*//* LOWERCASE_ENV [big]*//* OUTPUT_FOLDER [big]*//* PAAS_TYPE [big]*//* PIPELINE_DESCRIPTOR [big]*//* PROJECT_NAME [big]*//* PROJECT_SETUP [big]*//* ROOT_PROJECT_DIR [big]*//* SOURCE_ARTIFACT_TYPE_NAME [big]*//* TEST_REPORTS_FOLDER

apiCompatibilityCheck
~~~~~~~~~~~~~~~~~~~~~

____
 # Execute api compatibility check step. Uses the LATEST_PROD_TAG or PASSED_LATEST_PROD_TAG
 # env vars if latest production tag has already been retrieved. If not will call the
 # [findLatestProdTag] function to retrieve the latest production tag.
 #
 # Requires the [PROJECT_NAME] env variable to be set. Otherwise will not be able to
 # parse the latest production tag. As a reminder, latest production tag should be of
 # structure [dev/appName/version] or [prod/appName/version].
____

Has 20 line(s). Calls functions:

 apiCompatibilityCheck
 `-- executeApiCompatibilityCheck

Uses feature(s): _export_

Called by:

 build_api_compatibility_check.sh/Script-Body

_List of exports (to environment):_ LATEST_PROD_TAG [big]*//* PASSED_LATEST_PROD_TAG

_Environment variables used:_ OUTPUT_FOLDER [big]*//* PROJECT_NAME [big]*//* LATEST_PROD_TAG [big]*//* PASSED_LATEST_PROD_TAG

build
~~~~~

____
 # Build the application and produce a binary. Most likely you'll upload that binary somewhere
____

Has 3 line(s). Doesn't call other functions.

Called by:

 build_and_upload.sh/Script-Body

completeSwitchOver
~~~~~~~~~~~~~~~~~~

____
 # Deletes the old, Blue binary from the production environment
____

Has 2 line(s). Doesn't call other functions.

Called by:

 prod_complete.sh/Script-Body

defineProjectSetup
~~~~~~~~~~~~~~~~~~

____
 # Defines the project setup. Takes into consideration the location of the pipeline
 # descriptor, project name, main module path etc.
 # Sets the [PROJECT_SETUP], [ROOT_PROJECT_DIR] env vars.
 # Uses [PROJECT_NAME] env var and [getMainModulePath] functions
____

Has 32 line(s). Calls functions:

 defineProjectSetup
 `-- parsePipelineDescriptor

Called by:

 Script-Body

_Environment variables used:_ PROJECT_NAME [big]*//* PROJECT_SETUP [big]*//* PIPELINE_DESCRIPTOR_PRESENT

deleteService
~~~~~~~~~~~~~

____
 # Contract for deleting a service with name $1 and type $2
 #
 # $1 - service name
 # $2 - service type
____

Has 5 line(s). Doesn't call other functions.

Called by:

 deployServices

deployService
~~~~~~~~~~~~~

____
 # Contract for deploying a single service with name $1 and type $2
 #
 # $1 - service name
 # $2 - service type
____

Has 5 line(s). Doesn't call other functions.

Called by:

 deployServices

deployServices
~~~~~~~~~~~~~~

____
 # Deploys services assuming that pipeline descriptor exists
 # For TEST environment first deletes, then deploys services
 # For other environments only deploys a service if it wasn't there.
 # Uses ruby and jq
____

Has 28 line(s). Calls functions:

 deployServices
 |-- deleteService
 |-- deployService
 |-- envNodeExists
 `-- parsePipelineDescriptor

Uses feature(s): _read_

Called by:

 pipeline-cf.sh/stageDeploy
 pipeline-cf.sh/testDeploy
 pipeline-k8s.sh/testDeploy

_Environment variables used:_ LOWERCASE_ENV [big]*//* PARSED_YAML [big]*//* test_smoke.sh -> ENVIRONMENT

envNodeExists
~~~~~~~~~~~~~

____
 # Returns 0 if environment $1 node exists in the pipeline descriptor, 1 if it doesn't.
 # Requires the [PARSED_YAML] env var to contain the parsed descriptor
 #
 # $1 - name of the environment (e.g. test)
____

Has 8 line(s). Doesn't call other functions.

Called by:

 deployServices
 pipeline-cf.sh/propagatePropertiesForTests

_Environment variables used:_ PARSED_YAML

executeApiCompatibilityCheck
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

____
 # Execute api compatibility check step for the given latest production version $1
 #
 # $1 - retrieved latest production version
____

Has 3 line(s). Doesn't call other functions.

Called by:

 apiCompatibilityCheck

extractVersionFromProdTag
~~~~~~~~~~~~~~~~~~~~~~~~~

____
 # Extracts the version from the production tag
____

Has 2 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

findLatestProdTag
~~~~~~~~~~~~~~~~~

____
 # Echoes the latest prod tag from git with trimmed refs part. Uses the
 # LATEST_PROD_TAG and PASSED_LATEST_PROD_TAG env vars if latest production tag
 # was already found. If not, retrieves the latest prod tag via [latestProdTagFromGit]
 # function and sets the [PASSED_LATEST_PROD_TAG] and [LATEST_PROD_TAG] env vars with
 # the trimmed prod tag. Trimming occurs via the [trimRefsTag] function
____

Has 11 line(s). Doesn't call other functions.

Uses feature(s): _export_

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_List of exports (to environment):_ LATEST_PROD_TAG [big]*//* PASSED_LATEST_PROD_TAG

_Environment variables used:_ LATEST_PROD_TAG [big]*//* PASSED_LATEST_PROD_TAG

getMainModulePath
~~~~~~~~~~~~~~~~~

____
 # Gets the build coordinates from descriptor. Requires the [PARSED_YAML] to parse
 # otherwise returns empty main module
____

Has 10 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ PARSED_YAML

latestProdTagFromGit
~~~~~~~~~~~~~~~~~~~~

____
 # Echos latest productino tag from git
____

Has 3 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ GIT_BIN [big]*//* PROJECT_NAME

outputFolder
~~~~~~~~~~~~

____
 # Returns the folder where the built binary will be stored.
 # Example: 'target/' - for Maven, 'build/' - for Gradle etc.
____

Has 3 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

parsePipelineDescriptor
~~~~~~~~~~~~~~~~~~~~~~~

____
 # Sets the [PARSED_YAML] environment variable with contents of the parsed pipeline
 # descriptor assuming that the file described by the [PIPELINE_DESCRIPTOR] env variable
 # is present. If that's the case sets the [PIPELINE_DESCRIPTOR_PRESENT] to [true]
 # shellcheck disable=SC2120
____

Has 13 line(s). Doesn't call other functions.

Uses feature(s): _export_

Called by:

 Script-Body
 defineProjectSetup
 deployServices
 pipeline-cf.sh/prepareForSmokeTests
 pipeline-cf.sh/testRollbackDeploy
 pipeline-k8s.sh/testRollbackDeploy

_List of exports (to environment):_ PARSED_YAML [big]*//* PIPELINE_DESCRIPTOR_PRESENT

_Environment variables used:_ PIPELINE_DESCRIPTOR [big]*//* PARSED_YAML

prepareForE2eTests
~~~~~~~~~~~~~~~~~~

____
 # Prepares environment for smoke tests. Logs in to PAAS etc.
____

Has 2 line(s). Doesn't call other functions.

Called by:

 stage_e2e.sh/Script-Body

prepareForSmokeTests
~~~~~~~~~~~~~~~~~~~~

____
 # Prepares environment for smoke tests. Retrieves the latest production
 # tags, exports all URLs required for smoke tests, etc.
____

Has 3 line(s). Doesn't call other functions.

Called by:

 test_rollback_smoke.sh/Script-Body
 test_smoke.sh/Script-Body

prodDeploy
~~~~~~~~~~

____
 # Will deploy the Green binary next to the Blue one, on the production environment
____

Has 2 line(s). Doesn't call other functions.

Called by:

 prod_deploy.sh/Script-Body

projectType
~~~~~~~~~~~

____
 # Returns the type of the project basing on the cloned sources.
 # Example: MAVEN, GRADLE etc
____

Has 3 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

removeProdTag
~~~~~~~~~~~~~

____
 # Removes production tag.
 # Uses [PROJECT_NAME] and [PIPELINE_VERSION]
____

Has 4 line(s). Doesn't call other functions.

Called by:

 prod_rollback.sh/Script-Body

_Environment variables used:_ GIT_BIN [big]*//* PROJECT_NAME

retrieveAppName
~~~~~~~~~~~~~~~

____
 # Echos the name of the application
 # JVM world corresponds to a group id of a project
____

Has 2 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

retrieveGroupId
~~~~~~~~~~~~~~~

____
 # Echos the namespace that corresponds to the given application. In the
 # JVM world corresponds to a group id of a project
____

Has 3 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

retrieveStubRunnerIds
~~~~~~~~~~~~~~~~~~~~~

____
 # Retrieves the ids for Spring Cloud Contract Stub Runner. If you don't use
 # Stub Runner, overriding this method is not mandatory. The format of the IDS is
 # [groupId:artifactId:version:classifier:port]. E.g. [com.example:foo:1.0.0.RELEASE:stubs:1234]
____

Has 3 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

rollbackToPreviousVersion
~~~~~~~~~~~~~~~~~~~~~~~~~

____
 # Will rollback to blue instance
____

Has 2 line(s). Doesn't call other functions.

Called by:

 prod_rollback.sh/Script-Body

runE2eTests
~~~~~~~~~~~

____
 # Executes end to end tests. Profits from env vars set by 'prepareForE2eTests'
____

Has 2 line(s). Doesn't call other functions.

Called by:

 stage_e2e.sh/Script-Body

runSmokeTests
~~~~~~~~~~~~~

____
 # Executes smoke tests. Profits from env vars set by 'prepareForSmokeTests'
____

Has 2 line(s). Doesn't call other functions.

Called by:

 test_rollback_smoke.sh/Script-Body
 test_smoke.sh/Script-Body

serviceExists
~~~~~~~~~~~~~

____
 # Contract for verification if a service exists
 #
 # $1 - service type
 # $2 - service name
____

Has 6 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

stageDeploy
~~~~~~~~~~~

____
 # Deploy binaries and required services to stage environment
____

Has 2 line(s). Doesn't call other functions.

Called by:

 stage_deploy.sh/Script-Body

testDeploy
~~~~~~~~~~

____
 # Deploy binaries and required services to test environment
____

Has 2 line(s). Doesn't call other functions.

Called by:

 test_deploy.sh/Script-Body

testResultsAntPattern
~~~~~~~~~~~~~~~~~~~~~

____
 # Returns the ant pattern for the test results.
 # Example: '**/test-results/*.xml' - for Maven, '**/surefire-reports/*' - for Gradle etc.
____

Has 3 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

testRollbackDeploy
~~~~~~~~~~~~~~~~~~

____
 # Deploy binaries and required services to test environment for rollback testing
____

Has 2 line(s). Doesn't call other functions.

Called by:

 test_rollback_deploy.sh/Script-Body

toLowerCase
~~~~~~~~~~~

____
 # Converts a string $1 to lower case
 #
 # $1 - string to convert
____

Has 1 line(s). Doesn't call other functions.

Called by:

 pipeline-cf.sh/getArtifactType

trimRefsTag
~~~~~~~~~~~

____
 # Extracts latest prod tag
____

Has 2 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

yaml2json
~~~~~~~~~

____
 # Converts YAML to JSON - uses ruby
____

Has 1 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).


pipeline-projectType.sh(1)
==========================
:compat-mode!:

NAME
----
pipeline-projectType.sh - a shell script

SYNOPSIS
--------

Script that knows how to define the type of the project.
Scans for presence of files or the language type configuration.


FUNCTIONS
---------

 getLanguageType
 guessLanguageType

DETAILS
-------

Script Body
~~~~~~~~~~~

Has 24 line(s). No functions are called (may set up e.g. a hook, a Zle widget bound to a key, etc.).

Uses feature(s): _source_

getLanguageType
~~~~~~~~~~~~~~~

____
 # Gets the language type from the parsed descriptor. Returns empty if it's not present
 # or if [language_type] node is not present in the descriptor.
 # Uses [PARSER_YAML] env var
____

Has 10 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

guessLanguageType
~~~~~~~~~~~~~~~~~

____
 # Tries to guess the language type basing on the contents of the repository
____

Has 9 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).


pipeline-jvm.sh(1)
==================
:compat-mode!:

NAME
----
pipeline-jvm.sh - a shell script

SYNOPSIS
--------

Script that knows how to define the concrete type of the JVM project.
Scans for presence of files.


FUNCTIONS
---------

 downloadAppBinary
 isGradleProject
 isMavenProject
 projectType

DETAILS
-------

Script Body
~~~~~~~~~~~

Has 21 line(s). No functions are called (may set up e.g. a hook, a Zle widget bound to a key, etc.).

Uses feature(s): _export_, _source_

_Exports (environment):_ BINARY_EXTENSION [big]*//* MAVEN_OPTS [big]*//* PROJECT_TYPE [big]*//* projectType

downloadAppBinary
~~~~~~~~~~~~~~~~~

____
 # Fetches a JAR from a binary storage
 #
 # $1 - URL to repo with binaries
 # $2 - group id of the packaged sources
 # $3 - artifact id of the packaged sources
 # $4 - version of the packaged sources
____

Has 21 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ BINARY_EXTENSION

isGradleProject
~~~~~~~~~~~~~~~

____
 # Returns true if Gradle Wrapper is used
____

Has 1 line(s). Doesn't call other functions.

Called by:

 projectType

isMavenProject
~~~~~~~~~~~~~~

____
 # Returns true if Maven Wrapper is used
____

Has 1 line(s). Doesn't call other functions.

Called by:

 projectType

projectType
~~~~~~~~~~~

____
 # JVM implementation of projectType
____

Has 7 line(s). Calls functions:

 projectType
 |-- isGradleProject
 `-- isMavenProject

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).


pipeline-maven.sh(1)
====================
:compat-mode!:

NAME
----
pipeline-maven.sh - a shell script

SYNOPSIS
--------

Contains all Maven related build functions


FUNCTIONS
---------

 build
 executeApiCompatibilityCheck
 extractMavenProperty
 outputFolder
 printTestResults
 retrieveAppName
 retrieveGroupId
 retrieveStubRunnerIds
 runE2eTests
 runSmokeTests
 testResultsAntPattern

DETAILS
-------

Script Body
~~~~~~~~~~~

Has 24 line(s). No functions are called (may set up e.g. a hook, a Zle widget bound to a key, etc.).

Uses feature(s): _export_

_Exports (environment):_ BUILD_OPTIONS [big]*//* MAVENW_BIN [big]*//* build [big]*//* executeApiCompatibilityCheck [big]*//* outputFolder [big]*//* retrieveAppName [big]*//* retrieveGroupId [big]*//* runE2eTests [big]*//* runSmokeTests [big]*//* testResultsAntPattern

build
~~~~~

____
 # Maven implementation of build. Sets version, passes build options and distribution management properties.
 # Uses [PIPELINE_VERSION], [PASSED_PIPELINE_VERSION] and [M2_SETTINGS...], [REPO_WITH_BINARIES...] related env vars
____

Has 8 line(s). Calls functions:

 build
 `-- printTestResults

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ BUILD_OPTIONS [big]*//* MAVENW_BIN

executeApiCompatibilityCheck
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

____
 # Maven implementation of executing API compatibility check
____

Has 6 line(s). Calls functions:

 executeApiCompatibilityCheck
 `-- printTestResults

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ BUILD_OPTIONS [big]*//* MAVENW_BIN

extractMavenProperty
~~~~~~~~~~~~~~~~~~~~

____
 # The function uses Maven Wrapper to extract property with name $1
 #
 # $1 - name of the property to extract
____

Has 12 line(s). Doesn't call other functions.

Called by:

 retrieveStubRunnerIds

_Environment variables used:_ MAVENW_BIN

outputFolder
~~~~~~~~~~~~

____
 # Maven implementation of output folder
____

Has 1 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

printTestResults
~~~~~~~~~~~~~~~~

____
 # Prints test results. Used by Concourse.
____

Has 1 line(s). Doesn't call other functions.

Called by:

 build
 executeApiCompatibilityCheck
 runE2eTests
 runSmokeTests

retrieveAppName
~~~~~~~~~~~~~~~

____
 # For the given main module (if [getMainModulePath] function exists, it will return the path
 # to the main module), will use [ruby] if possible to return the application name. If that
 # doesn't bring a result, will use Maven to extract the artifact id.
 #
 # $1 - path to main module
____

Has 14 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ MAVENW_BIN

retrieveGroupId
~~~~~~~~~~~~~~~

____
 # Maven implementation of group id retrieval. First tries to use [ruby] to extract the
 # group id, if that's not possible uses Maven to do it. Requires path $1 to pom.xml
 #
 # $1 - path to pom.xml
____

Has 8 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ MAVENW_BIN

retrieveStubRunnerIds
~~~~~~~~~~~~~~~~~~~~~

____
 # Extracts the stub runner ids from the Maven properties
____

Has 1 line(s). Calls functions:

 retrieveStubRunnerIds
 `-- extractMavenProperty

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

runE2eTests
~~~~~~~~~~~

____
 # Given [APPLICATION_URL] will run the tests with [e2e] profile
____

Has 8 line(s). Calls functions:

 runE2eTests
 `-- printTestResults

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ BUILD_OPTIONS [big]*//* MAVENW_BIN

runSmokeTests
~~~~~~~~~~~~~

____
 # Given [APPLICATION_URL] and [STUBRUNNER_URL] will run the tests with [smoke] profile
____

Has 9 line(s). Calls functions:

 runSmokeTests
 `-- printTestResults

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ BUILD_OPTIONS [big]*//* MAVENW_BIN

testResultsAntPattern
~~~~~~~~~~~~~~~~~~~~~

____
 # Maven implementation of test results ant pattern
____

Has 1 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).


pipeline-gradle.sh(1)
=====================
:compat-mode!:

NAME
----
pipeline-gradle.sh - a shell script

SYNOPSIS
--------

Contains all Gradle related build functions


FUNCTIONS
---------

 build
 executeApiCompatibilityCheck
 outputFolder
 printTestResults
 retrieveAppName
 retrieveGroupId
 retrieveStubRunnerIds
 runE2eTests
 runSmokeTests
 testResultsAntPattern

DETAILS
-------

Script Body
~~~~~~~~~~~

Has 24 line(s). No functions are called (may set up e.g. a hook, a Zle widget bound to a key, etc.).

Uses feature(s): _export_

_Exports (environment):_ BUILD_OPTIONS [big]*//* GRADLEW_BIN [big]*//* build [big]*//* executeApiCompatibilityCheck [big]*//* outputFolder [big]*//* retrieveAppName [big]*//* retrieveGroupId [big]*//* runE2eTests [big]*//* runSmokeTests [big]*//* testResultsAntPattern

build
~~~~~

____
 # Gradle implementation of build. Sets version, passes build options and distribution management properties.
 # Uses [PIPELINE_VERSION], [PASSED_PIPELINE_VERSION] and [M2_SETTINGS...], [REPO_WITH_BINARIES...] related env vars
____

Has 7 line(s). Calls functions:

 build
 `-- printTestResults

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ GRADLEW_BIN [big]*//* pipeline-maven.sh -> BUILD_OPTIONS

executeApiCompatibilityCheck
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

____
 # Gradle implementation of executing API compatibility check
____

Has 6 line(s). Calls functions:

 executeApiCompatibilityCheck
 `-- printTestResults

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ GRADLEW_BIN [big]*//* pipeline-maven.sh -> BUILD_OPTIONS

outputFolder
~~~~~~~~~~~~

____
 # Gradle implementation of output folder
____

Has 1 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

printTestResults
~~~~~~~~~~~~~~~~

____
 # Prints test results. Used by Concourse.
____

Has 1 line(s). Doesn't call other functions.

Called by:

 build
 executeApiCompatibilityCheck
 runE2eTests
 runSmokeTests

retrieveAppName
~~~~~~~~~~~~~~~

____
 # Gradle implementation of app name retrieval
____

Has 1 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ GRADLEW_BIN

retrieveGroupId
~~~~~~~~~~~~~~~

____
 # Gradle implementation of group id retrieval
____

Has 1 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ GRADLEW_BIN

retrieveStubRunnerIds
~~~~~~~~~~~~~~~~~~~~~

____
 # Extracts the stub runner ids from the Gradle properties
____

Has 1 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ GRADLEW_BIN

runE2eTests
~~~~~~~~~~~

____
 # Given [APPLICATION_URL] will run the tests via [e2e] task
____

Has 9 line(s). Calls functions:

 runE2eTests
 `-- printTestResults

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ GRADLEW_BIN [big]*//* pipeline-maven.sh -> BUILD_OPTIONS

runSmokeTests
~~~~~~~~~~~~~

____
 # Given [APPLICATION_URL] and [STUBRUNNER_URL] will run the tests via [smoke] task
____

Has 10 line(s). Calls functions:

 runSmokeTests
 `-- printTestResults

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ GRADLEW_BIN [big]*//* pipeline-maven.sh -> BUILD_OPTIONS

testResultsAntPattern
~~~~~~~~~~~~~~~~~~~~~

____
 # Gradle implementation of test results ant pattern
____

Has 1 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).


pipeline-php.sh(1)
==================
:compat-mode!:

NAME
----
pipeline-php.sh - a shell script

SYNOPSIS
--------

Contains all PHP related build functions


FUNCTIONS
---------

 build
 downloadAppBinary
 downloadComposerIfMissing
 executeApiCompatibilityCheck
 installPhpIfMissing
 outputFolder
 projectType
 retrieveAppName
 retrieveGroupId
 retrieveStubRunnerIds
 runE2eTests
 runSmokeTests
 testResultsAntPattern

DETAILS
-------

Script Body
~~~~~~~~~~~

Has 20 line(s). No functions are called (may set up e.g. a hook, a Zle widget bound to a key, etc.).

Uses feature(s): _export_

_Exports (environment):_ ARTIFACT_TYPE [big]*//* COMPOSER_BIN [big]*//* DOWNLOADABLE_SOURCES [big]*//* PHP_BIN

build
~~~~~

____
 # PHP implementation of the build function.
 # Requires [composer] and [php]. Installs those if possible
____

Has 30 line(s). Calls functions:

 build
 `-- downloadComposerIfMissing
     `-- installPhpIfMissing

Uses feature(s): _trap_

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ pipeline-jvm.sh -> BINARY_EXTENSION [big]*//* COMPOSER_BIN

downloadAppBinary
~~~~~~~~~~~~~~~~~

____
 # Fetches PHP tar.gz sources from a binary storage
 #
 # $1 - URL to repo with binaries
 # $2 - group id of the packaged sources
 # $3 - artifact id of the packaged sources
 # $4 - version of the packaged sources
____

Has 26 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ pipeline-jvm.sh -> BINARY_EXTENSION

downloadComposerIfMissing
~~~~~~~~~~~~~~~~~~~~~~~~~

____
 # Downloads and installs PHP and Composer if missing
____

Has 13 line(s). Calls functions:

 downloadComposerIfMissing
 `-- installPhpIfMissing

Called by:

 build
 executeApiCompatibilityCheck
 retrieveAppName
 retrieveGroupId
 retrieveStubRunnerIds
 runE2eTests
 runSmokeTests

_Environment variables used:_ COMPOSER_BIN [big]*//* PHP_BIN

executeApiCompatibilityCheck
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

____
 # PHP implementation of the execute API compatibility check
____

Has 2 line(s). Calls functions:

 executeApiCompatibilityCheck
 `-- downloadComposerIfMissing
     `-- installPhpIfMissing

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ COMPOSER_BIN

installPhpIfMissing
~~~~~~~~~~~~~~~~~~~

____
 # Downloads and installs PHP if missing
____

Has 9 line(s). Doesn't call other functions.

Uses feature(s): _export_

Called by:

 downloadComposerIfMissing

_List of exports (to environment):_ LANG

_Environment variables used:_ PHP_BIN

outputFolder
~~~~~~~~~~~~

____
 # PHP implementation of the output folder
____

Has 1 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

projectType
~~~~~~~~~~~

____
 # PHP implementation of the project type
____

Has 1 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

retrieveAppName
~~~~~~~~~~~~~~~

____
 # PHP implementation of the retrieve application name
____

Has 6 line(s). Calls functions:

 retrieveAppName
 `-- downloadComposerIfMissing
     `-- installPhpIfMissing

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ COMPOSER_BIN

retrieveGroupId
~~~~~~~~~~~~~~~

____
 # PHP implementation of the retrieve group id
____

Has 2 line(s). Calls functions:

 retrieveGroupId
 `-- downloadComposerIfMissing
     `-- installPhpIfMissing

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ COMPOSER_BIN

retrieveStubRunnerIds
~~~~~~~~~~~~~~~~~~~~~

____
 # PHP implementation of the retrieve stub runner ids
____

Has 2 line(s). Calls functions:

 retrieveStubRunnerIds
 `-- downloadComposerIfMissing
     `-- installPhpIfMissing

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ COMPOSER_BIN

runE2eTests
~~~~~~~~~~~

____
 # PHP implementation of the run e2e tests
____

Has 2 line(s). Calls functions:

 runE2eTests
 `-- downloadComposerIfMissing
     `-- installPhpIfMissing

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ COMPOSER_BIN

runSmokeTests
~~~~~~~~~~~~~

____
 # PHP implementation of the run smoke tests
____

Has 2 line(s). Calls functions:

 runSmokeTests
 `-- downloadComposerIfMissing
     `-- installPhpIfMissing

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ COMPOSER_BIN

testResultsAntPattern
~~~~~~~~~~~~~~~~~~~~~

____
 # PHP implementation of the test results ant pattern
____

Has 1 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).


pipeline-npm.sh(1)
==================
:compat-mode!:

NAME
----
pipeline-npm.sh - a shell script

SYNOPSIS
--------

Contains all NPM related build functions


FUNCTIONS
---------

 build
 downloadAppBinary
 downloadNpmIfMissing
 executeApiCompatibilityCheck
 installNodeIfMissing
 outputFolder
 projectType
 retrieveAppName
 retrieveGroupId
 retrieveStubRunnerIds
 runE2eTests
 runSmokeTests
 testResultsAntPattern

DETAILS
-------

Script Body
~~~~~~~~~~~

Has 15 line(s). No functions are called (may set up e.g. a hook, a Zle widget bound to a key, etc.).

Uses feature(s): _export_

_Exports (environment):_ ARTIFACT_TYPE [big]*//* NODE_BIN [big]*//* NPM_BIN

build
~~~~~

____
 # npm implementation of the build function.
 # Requires [npm] and [node]. Installs those if possible
____

Has 3 line(s). Calls functions:

 build
 `-- downloadNpmIfMissing
     `-- installNodeIfMissing

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ NPM_BIN

downloadAppBinary
~~~~~~~~~~~~~~~~~

____
 # Just downloads the npm libraries. We will use sources
____

Has 2 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ NPM_BIN

downloadNpmIfMissing
~~~~~~~~~~~~~~~~~~~~

____
 # Downloads and installs node and npm if missing
____

Has 6 line(s). Calls functions:

 downloadNpmIfMissing
 `-- installNodeIfMissing

Called by:

 build
 executeApiCompatibilityCheck
 retrieveAppName
 retrieveGroupId
 retrieveStubRunnerIds
 runE2eTests
 runSmokeTests

_Environment variables used:_ NPM_BIN

executeApiCompatibilityCheck
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

____
 # npm implementation of the execute API compatibility check
____

Has 2 line(s). Calls functions:

 executeApiCompatibilityCheck
 `-- downloadNpmIfMissing
     `-- installNodeIfMissing

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ NPM_BIN

installNodeIfMissing
~~~~~~~~~~~~~~~~~~~~

____
 # Installs node if missing
____

Has 7 line(s). Doesn't call other functions.

Uses feature(s): _export_

Called by:

 downloadNpmIfMissing

_List of exports (to environment):_ LANG

_Environment variables used:_ NODE_BIN

outputFolder
~~~~~~~~~~~~

____
 # npm implementation of the output folder
____

Has 1 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

projectType
~~~~~~~~~~~

____
 # npm implementation of the project type
____

Has 1 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

retrieveAppName
~~~~~~~~~~~~~~~

____
 # npm implementation of the retrieve app name
____

Has 6 line(s). Calls functions:

 retrieveAppName
 `-- downloadNpmIfMissing
     `-- installNodeIfMissing

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ NPM_BIN

retrieveGroupId
~~~~~~~~~~~~~~~

____
 # npm implementation of the retrieve group id
____

Has 2 line(s). Calls functions:

 retrieveGroupId
 `-- downloadNpmIfMissing
     `-- installNodeIfMissing

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ NPM_BIN

retrieveStubRunnerIds
~~~~~~~~~~~~~~~~~~~~~

____
 # npm implementation of the retrieve stub runner ids
____

Has 2 line(s). Calls functions:

 retrieveStubRunnerIds
 `-- downloadNpmIfMissing
     `-- installNodeIfMissing

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ NPM_BIN

runE2eTests
~~~~~~~~~~~

____
 # npm implementation of the e2e tests
____

Has 2 line(s). Calls functions:

 runE2eTests
 `-- downloadNpmIfMissing
     `-- installNodeIfMissing

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ NPM_BIN

runSmokeTests
~~~~~~~~~~~~~

____
 # npm implementation of the run smoke tests
____

Has 2 line(s). Calls functions:

 runSmokeTests
 `-- downloadNpmIfMissing
     `-- installNodeIfMissing

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ NPM_BIN

testResultsAntPattern
~~~~~~~~~~~~~~~~~~~~~

____
 # npm implementation of the test results ant pattern
____

Has 1 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).


pipeline-cf.sh(1)
=================
:compat-mode!:

NAME
----
pipeline-cf.sh - a shell script

SYNOPSIS
--------

Contains all Cloud Foundry related deployment functions


FUNCTIONS
---------

 addMultiplePortsSupport
 bindService
 completeSwitchOver
 createServiceWithName
 deleteApp
 deleteService
 deployAndRestartAppWithName
 deployAppAsService
 deployAppNoStart
 deployBrokeredService
 deployCupsService
 deployService
 deployStubRunnerBoot
 getAppHostFromPaas
 getArtifactType
 getDomain
 getHostFromManifest
 getInstancesFromManifest
 getProfilesFromManifest
 hostname
 logInToPaas
 parseManifest
 pathToPushToCf
 pathToUnpackedSources
 performProductionDeploymentOfTestedApplication
 prepareForE2eTests
 prepareForSmokeTests
 prodDeploy
 propagatePropertiesForTests
 readTestPropertiesFromFile
 restartApp
 retrieveApplicationUrl
 rollbackToPreviousVersion
 setEnvVar
 setEnvVarIfMissing
 stageDeploy
 testCleanup
 testDeploy
 testRollbackDeploy
 waitForServicesToInitialize

DETAILS
-------

Script Body
~~~~~~~~~~~

Has 11 line(s). No functions are called (may set up e.g. a hook, a Zle widget bound to a key, etc.).

Uses feature(s): _export_

_Exports (environment):_ CF_BIN [big]*//* CF_CLI_URL [big]*//* RETRIEVE_STUBRUNNER_IDS_FUNCTION

addMultiplePortsSupport
~~~~~~~~~~~~~~~~~~~~~~~

____
 # Adds multiple ports support for Stub Runner Boot
 # Uses [PAAS_TEST_SPACE_PREFIX], [ENVIRONMENT] env vars
 #
 # $1 - Stub Runner name
 # $2 - IDs of stubs to be downloaded
 # $3 - path to Stub Runner manifest
____

Has 49 line(s). Calls functions:

 addMultiplePortsSupport
 `-- setEnvVar

Called by:

 deployStubRunnerBoot

_Environment variables used:_ CF_BIN [big]*//* test_smoke.sh -> ENVIRONMENT

bindService
~~~~~~~~~~~

____
 # Binds service $1 to application $2
 #
 # $1 - service name
 # $2 - application name
____

Has 9 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ CF_BIN

completeSwitchOver
~~~~~~~~~~~~~~~~~~

____
 # Performs switch over of the venerable app (VEN) and leaves only current one (APP) running
 # APP - current app to deploy, VEN - old (venerable), currently running app on production
 # [Clicked COMPLETE] -> APP running, VEN stopped
____

Has 12 line(s). Calls functions:

 completeSwitchOver
 `-- logInToPaas

Called by:

 prod_complete.sh/Script-Body

_Environment variables used:_ CF_BIN

createServiceWithName
~~~~~~~~~~~~~~~~~~~~~

____
 # Creates a CUPS (user provided service) for service with name $1
 #
 # $1 - service name
____

Has 5 line(s). Calls functions:

 createServiceWithName
 `-- deployCupsService

Called by:

 deployAppAsService

deleteApp
~~~~~~~~~

____
 # Deletes app with name $1 from CF
 #
 # $1 - app name
____

Has 6 line(s). Doesn't call other functions.

Called by:

 testRollbackDeploy

_Environment variables used:_ CF_BIN

deleteService
~~~~~~~~~~~~~

____
 # Implementation of the CF delete service
 #
 # $1 - service name
 # $2 - service type
____

Has 5 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ CF_BIN

deployAndRestartAppWithName
~~~~~~~~~~~~~~~~~~~~~~~~~~~

____
 # Deploys and restarts app with name $1 and binary name $2
 #
 # $1 - app name
 # $2 - binary name
____

Has 22 line(s). Calls functions:

 deployAndRestartAppWithName
 |-- deployAppNoStart
 |   `-- setEnvVar
 |-- parseManifest
 |-- restartApp
 `-- setEnvVar

Called by:

 performProductionDeploymentOfTestedApplication
 stageDeploy
 testDeploy
 testRollbackDeploy

_Environment variables used:_ test_smoke.sh -> ENVIRONMENT

deployAppAsService
~~~~~~~~~~~~~~~~~~

____
 # For app with binary name $1, app name $2 and manifest location $3, deploys the app to CF
 # and creates a user provided services for it
 #
 # $1 - binary name
 # $2 - app name
 # $3 - manifest location
____

Has 11 line(s). Calls functions:

 deployAppAsService
 |-- createServiceWithName
 |   `-- deployCupsService
 |-- deployAppNoStart
 |   `-- setEnvVar
 `-- restartApp

Called by:

 deployService

_Environment variables used:_ pipeline.sh -> LOWERCASE_ENV [big]*//* test_smoke.sh -> ENVIRONMENT

deployAppNoStart
~~~~~~~~~~~~~~~~

____
 # Deploys an app without starting it
 #
 # $1 - app name
 # $2 - artifact name
 # $3 - environment name
 # $4 - path to manifest
 # $5 - host name suffix
____

Has 35 line(s). Calls functions:

 deployAppNoStart
 `-- setEnvVar

Called by:

 deployAndRestartAppWithName
 deployAppAsService
 deployStubRunnerBoot

_Environment variables used:_ CF_BIN [big]*//* pipeline.sh -> DOWNLOADABLE_SOURCES [big]*//* pipeline.sh -> SOURCE_ARTIFACT_TYPE_NAME

deployBrokeredService
~~~~~~~~~~~~~~~~~~~~~

____
 # Deploys a brokered service with name $1, broker service type $2, plan $3 and parameters $4
 #
 # $1 - service name
 # $2 - broker service type
 # $3 - broker service plan
 # $4 - broker service parameters
____

Has 17 line(s). Doesn't call other functions.

Called by:

 deployService

_Environment variables used:_ CF_BIN [big]*//* pipeline.sh -> LOWERCASE_ENV [big]*//* pipeline.sh -> OUTPUT_FOLDER

deployCupsService
~~~~~~~~~~~~~~~~~

____
 # Deploys a CUPS (user provided service) with name $1, option $2 and value $3
 # Uses [OUTPUT_FOLDER] and [LOWERCASE_ENV] env variables
 #
 # $1 - service name
 # $2 - cups option
 # $3 - cups value
____

Has 13 line(s). Doesn't call other functions.

Called by:

 createServiceWithName
 deployService

_Environment variables used:_ CF_BIN [big]*//* pipeline.sh -> LOWERCASE_ENV [big]*//* pipeline.sh -> OUTPUT_FOLDER

deployService
~~~~~~~~~~~~~

____
 # Implementation of the CF deployment of a service
 #
 # $1 - service name
 # $2 - service type
____

Has 57 line(s). Calls functions:

 deployService
 |-- deployAppAsService
 |   |-- createServiceWithName
 |   |   `-- deployCupsService
 |   |-- deployAppNoStart
 |   |   `-- setEnvVar
 |   `-- restartApp
 |-- deployBrokeredService
 |-- deployCupsService
 `-- deployStubRunnerBoot
     |-- addMultiplePortsSupport
     |   `-- setEnvVar
     |-- deployAppNoStart
     |   `-- setEnvVar
     |-- restartApp
     `-- setEnvVar

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ pipeline.sh -> LOWERCASE_ENV [big]*//* pipeline.sh -> PARSED_YAML

deployStubRunnerBoot
~~~~~~~~~~~~~~~~~~~~

____
 # Deploys a Stub Runner Boot instance to CF
 # Uses [REPO_WITH_BINARIES], [ENVIRONMENT] env vars
 #
 # $1 - Stub Runner Boot jar name
 # $2 - Stub Runner name
 # $3 - path to Stub Runner manifest
____

Has 16 line(s). Calls functions:

 deployStubRunnerBoot
 |-- addMultiplePortsSupport
 |   `-- setEnvVar
 |-- deployAppNoStart
 |   `-- setEnvVar
 |-- restartApp
 `-- setEnvVar

Called by:

 deployService

_Environment variables used:_ RETRIEVE_STUBRUNNER_IDS_FUNCTION [big]*//* test_smoke.sh -> ENVIRONMENT

getAppHostFromPaas
~~~~~~~~~~~~~~~~~~

____
 # Gets app host for app with name $1 from CF
 #
 # $1 - app name
____

Has 4 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ CF_BIN

getArtifactType
~~~~~~~~~~~~~~~

____
 # Gets the type of artifact that should be pushed to CF. [binary] or [source]?
 # Uses [ARTIFACT_TYPE], [PARSED_YAML], [LANGUAGE_TYPE] env vars
____

Has 16 line(s). Calls functions:

 getArtifactType
 `-- pipeline.sh/toLowerCase

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ pipeline.sh -> BINARY_ARTIFACT_TYPE_NAME [big]*//* pipeline.sh -> LANGUAGE_TYPE [big]*//* pipeline.sh -> SOURCE_ARTIFACT_TYPE_NAME [big]*//* pipeline.sh -> PARSED_YAML

getDomain
~~~~~~~~~

____
 # Gets domain from host $1
 #
 # $1 - host name
____

Has 2 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ CF_BIN

getHostFromManifest
~~~~~~~~~~~~~~~~~~~

____
 # Gets host from [PARSED_APP_MANIFEST_YAML] for app with name $1
 #
 # $1 - app name
____

Has 3 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ PARSED_APP_MANIFEST_YAML

getInstancesFromManifest
~~~~~~~~~~~~~~~~~~~~~~~~

____
 # Gets instances from [PARSED_APP_MANIFEST_YAML] for app with name $1
 #
 # $1 - app name
____

Has 2 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ PARSED_APP_MANIFEST_YAML

getProfilesFromManifest
~~~~~~~~~~~~~~~~~~~~~~~

____
 # Gets profiles from [PARSED_APP_MANIFEST_YAML] for app with name $1
 #
 # $1 - app name
____

Has 2 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ PARSED_APP_MANIFEST_YAML

hostname
~~~~~~~~

____
 # Returns hostname for app with name $1, env $2 and manifest location $3
 # Uses [PAAS_HOSTNAME_UUID] and [LOWERCASE_ENV] env vars
 #
 # $1 - app name
 # $2 - environment name
 # $3 - manifest location
____

Has 20 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ pipeline.sh -> LOWERCASE_ENV

logInToPaas
~~~~~~~~~~~

____
 # Implementation of the CF log in. Will work in the following way:
 #
 # * Will use CF if one is present (good for envs that are fully offline)
 # * You can disable the redownload CF with [CF_REDOWNLOAD_CLI] env set to [false]
 # * You can provide the URL from which to fetch the CLI via [CF_CLI_URL]
 #
 # Also [CF_TEST_MODE] is used for tests and all the combinations of
 # [PAAS_..._USERNAME/PASSWORD/ORG/SPACE/API_URL] to log in to PAAS
____

Has 38 line(s). Doesn't call other functions.

Called by:

 completeSwitchOver
 prepareForE2eTests
 prepareForSmokeTests
 prodDeploy
 retrieveApplicationUrl
 rollbackToPreviousVersion
 stageDeploy
 testDeploy
 testRollbackDeploy

_Environment variables used:_ CF_BIN [big]*//* CF_CLI_URL [big]*//* pipeline.sh -> LOWERCASE_ENV [big]*//* test_smoke.sh -> ENVIRONMENT

parseManifest
~~~~~~~~~~~~~

____
 # Parses the [manifest.yml] file into [PARSED_APP_MANIFEST_YAML] env var
____

Has 8 line(s). Doesn't call other functions.

Uses feature(s): _export_

Called by:

 deployAndRestartAppWithName

_List of exports (to environment):_ PARSED_APP_MANIFEST_YAML

_Environment variables used:_ PARSED_APP_MANIFEST_YAML

pathToPushToCf
~~~~~~~~~~~~~~

____
 # Returns the path to push to CF for artifact with name $1
 #
 # $1 - artifact name
____

Has 11 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ pipeline.sh -> BINARY_ARTIFACT_TYPE_NAME [big]*//* pipeline.sh -> OUTPUT_FOLDER [big]*//* pipeline.sh -> SOURCE_ARTIFACT_TYPE_NAME

pathToUnpackedSources
~~~~~~~~~~~~~~~~~~~~~

____
 # Returns the path to unpacked sources. Uses [OUTPUT_FOLDER] env var
____

Has 1 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ pipeline.sh -> OUTPUT_FOLDER

performProductionDeploymentOfTestedApplication
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

____
 # Performs production deployment of application (APP)
 # APP - current app to deploy, VEN - old (venerable), currently running app on production
 # [Clicked DEPLOY] -> APP running, VEN running -> [Click DEPLOY] delete VEN, deploy new APP
 # [Clicked COMPLETE] -> APP running, VEN stopped -> [Click DEPLOY] delete VEN, rename APP -> VEN, deploy APP
 # [Clicked ROLLBACK] -> APP stopped, VEN running, VEN renamed to APP, latest PROD tag removed -> [Click DEPLOY] -> delete APP, deploy new APP, stop VEN
____

Has 27 line(s). Calls functions:

 performProductionDeploymentOfTestedApplication
 `-- deployAndRestartAppWithName
     |-- deployAppNoStart
     |   `-- setEnvVar
     |-- parseManifest
     |-- restartApp
     `-- setEnvVar

Called by:

 prodDeploy

_Environment variables used:_ CF_BIN

prepareForE2eTests
~~~~~~~~~~~~~~~~~~

____
 # CF implementation of prepare for e2e tests
 # You can skip that via [CF_SKIP_PREPARE_FOR_TESTS] set to [true]
____

Has 9 line(s). Calls functions:

 prepareForE2eTests
 `-- logInToPaas

Uses feature(s): _export_

Called by:

 stage_e2e.sh/Script-Body

_List of exports (to environment):_ APPLICATION_URL

_Environment variables used:_ APPLICATION_URL

prepareForSmokeTests
~~~~~~~~~~~~~~~~~~~~

____
 # CF implementation of prepare for smoke tests, can log in to PAAS to retrieve info about
 # the app. You can skip that via [CF_SKIP_PREPARE_FOR_TESTS] set to [true]
____

Has 15 line(s). Calls functions:

 prepareForSmokeTests
 |-- logInToPaas
 |-- pipeline.sh/parsePipelineDescriptor
 |-- propagatePropertiesForTests
 |   `-- pipeline.sh/envNodeExists
 `-- readTestPropertiesFromFile

Called by:

 test_rollback_smoke.sh/Script-Body
 test_smoke.sh/Script-Body

_Environment variables used:_ APPLICATION_URL [big]*//* STUBRUNNER_URL [big]*//* pipeline.sh -> OUTPUT_FOLDER [big]*//* pipeline.sh -> LATEST_PROD_TAG

prodDeploy
~~~~~~~~~~

____
 # CF implementation of deploy to production
____

Has 7 line(s). Calls functions:

 prodDeploy
 |-- logInToPaas
 `-- performProductionDeploymentOfTestedApplication
     `-- deployAndRestartAppWithName
         |-- deployAppNoStart
         |   `-- setEnvVar
         |-- parseManifest
         |-- restartApp
         `-- setEnvVar

Called by:

 prod_deploy.sh/Script-Body

propagatePropertiesForTests
~~~~~~~~~~~~~~~~~~~~~~~~~~~

____
 # For project with name $1 resolves application URL and stub runner URL if applicable
 #
 # exports [APPLICATION_URL] and [STUBRUNNER_URL] env vars and stores those values in a
 # properties file
 #
 # $1 - application name
____

Has 21 line(s). Calls functions:

 propagatePropertiesForTests
 `-- pipeline.sh/envNodeExists

Uses feature(s): _export_

Called by:

 prepareForSmokeTests
 retrieveApplicationUrl
 stageDeploy
 testDeploy
 testRollbackDeploy

_List of exports (to environment):_ APPLICATION_URL [big]*//* STUBRUNNER_URL

_Environment variables used:_ pipeline.sh -> LOWERCASE_ENV [big]*//* pipeline.sh -> OUTPUT_FOLDER [big]*//* pipeline.sh -> PARSED_YAML

readTestPropertiesFromFile
~~~~~~~~~~~~~~~~~~~~~~~~~~

____
 # Reads a properties file as env variables
 # shellcheck disable=SC2120
____

Has 12 line(s). Doesn't call other functions.

Uses feature(s): _eval_

Called by:

 prepareForSmokeTests
 retrieveApplicationUrl

_Environment variables used:_ pipeline.sh -> OUTPUT_FOLDER

restartApp
~~~~~~~~~~

____
 # Restarts app with name $1
 #
 # $1 - app name
____

Has 3 line(s). Doesn't call other functions.

Called by:

 deployAndRestartAppWithName
 deployAppAsService
 deployStubRunnerBoot

_Environment variables used:_ CF_BIN

retrieveApplicationUrl
~~~~~~~~~~~~~~~~~~~~~~

____
 # Retrieves the application URL from CF
____

Has 9 line(s). Calls functions:

 retrieveApplicationUrl
 |-- logInToPaas
 |-- propagatePropertiesForTests
 |   `-- pipeline.sh/envNodeExists
 `-- readTestPropertiesFromFile

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ APPLICATION_URL [big]*//* pipeline.sh -> OUTPUT_FOLDER

rollbackToPreviousVersion
~~~~~~~~~~~~~~~~~~~~~~~~~

____
 # Performs rollback of application (APP)
 # APP - current app to deploy, VEN - old (venerable), currently running app on production
 # [Clicked ROLLBACK] -> APP stopped, VEN running
____

Has 16 line(s). Calls functions:

 rollbackToPreviousVersion
 `-- logInToPaas

Called by:

 prod_rollback.sh/Script-Body

_Environment variables used:_ CF_BIN

setEnvVar
~~~~~~~~~

____
 # For app with name $1 sets env var with key $2 and value $3
 #
 # $1 - app name
 # $2 - env variable key
 # $3 - env variable value
____

Has 5 line(s). Doesn't call other functions.

Called by:

 addMultiplePortsSupport
 deployAndRestartAppWithName
 deployAppNoStart
 deployStubRunnerBoot
 setEnvVarIfMissing

_Environment variables used:_ CF_BIN

setEnvVarIfMissing
~~~~~~~~~~~~~~~~~~

____
 # For app with name $1 sets env var with key $2 and value $3 if that value is missing
 #
 # $1 - app name
 # $2 - env variable key
 # $3 - env variable value
____

Has 5 line(s). Calls functions:

 setEnvVarIfMissing
 `-- setEnvVar

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ CF_BIN

stageDeploy
~~~~~~~~~~~

____
 # CF implementation of deployment to stage
____

Has 12 line(s). Calls functions:

 stageDeploy
 |-- deployAndRestartAppWithName
 |   |-- deployAppNoStart
 |   |   `-- setEnvVar
 |   |-- parseManifest
 |   |-- restartApp
 |   `-- setEnvVar
 |-- logInToPaas
 |-- pipeline.sh/deployServices
 |-- propagatePropertiesForTests
 |   `-- pipeline.sh/envNodeExists
 `-- waitForServicesToInitialize

Called by:

 stage_deploy.sh/Script-Body

testCleanup
~~~~~~~~~~~

____
 # Uses a community plugin to clean up the whole test space
____

Has 2 line(s). Doesn't call other functions.

Called by:

 testDeploy

_Environment variables used:_ CF_BIN

testDeploy
~~~~~~~~~~

____
 # Implementation of the CF deployment to test
____

Has 13 line(s). Calls functions:

 testDeploy
 |-- deployAndRestartAppWithName
 |   |-- deployAppNoStart
 |   |   `-- setEnvVar
 |   |-- parseManifest
 |   |-- restartApp
 |   `-- setEnvVar
 |-- logInToPaas
 |-- pipeline.sh/deployServices
 |-- propagatePropertiesForTests
 |   `-- pipeline.sh/envNodeExists
 |-- testCleanup
 `-- waitForServicesToInitialize

Called by:

 test_deploy.sh/Script-Body

testRollbackDeploy
~~~~~~~~~~~~~~~~~~

____
 # Implementation of the CF deployment to test for rollback tests
____

Has 15 line(s). Calls functions:

 testRollbackDeploy
 |-- deleteApp
 |-- deployAndRestartAppWithName
 |   |-- deployAppNoStart
 |   |   `-- setEnvVar
 |   |-- parseManifest
 |   |-- restartApp
 |   `-- setEnvVar
 |-- logInToPaas
 |-- pipeline.sh/parsePipelineDescriptor
 `-- propagatePropertiesForTests
     `-- pipeline.sh/envNodeExists

Called by:

 test_rollback_deploy.sh/Script-Body

_Environment variables used:_ pipeline.sh -> OUTPUT_FOLDER [big]*//* pipeline.sh -> PROJECT_NAME

waitForServicesToInitialize
~~~~~~~~~~~~~~~~~~~~~~~~~~~

____
 # Waits for services to initialize
____

Has 10 line(s). Doesn't call other functions.

Called by:

 stageDeploy
 testDeploy

_Environment variables used:_ CF_BIN


pipeline-k8s.sh(1)
==================
:compat-mode!:

NAME
----
pipeline-k8s.sh - a shell script

SYNOPSIS
--------

Contains all Kubernetes related deployment functions


FUNCTIONS
---------

 deployService
 logInToPaas
 testDeploy
 testRollbackDeploy

DETAILS
-------

Script Body
~~~~~~~~~~~

Has 5 line(s). No functions are called (may set up e.g. a hook, a Zle widget bound to a key, etc.).

deployService
~~~~~~~~~~~~~

Has 680 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ pipeline.sh -> LOWERCASE_ENV [big]*//* pipeline.sh -> OUTPUT_FOLDER [big]*//* pipeline.sh -> PARSED_YAML [big]*//* test_smoke.sh -> ENVIRONMENT

logInToPaas
~~~~~~~~~~~

____
 # Contains all Kubernetes related deployment functions
 # }}}
____

Has 57 line(s). Doesn't call other functions.

Uses feature(s): _trap_

Called by:

 testDeploy
 testRollbackDeploy

_Environment variables used:_ test_smoke.sh -> ENVIRONMENT

testDeploy
~~~~~~~~~~

Has 6 line(s). Calls functions:

 testDeploy
 |-- logInToPaas
 `-- pipeline.sh/deployServices

Called by:

 test_deploy.sh/Script-Body

testRollbackDeploy
~~~~~~~~~~~~~~~~~~

Has 12 line(s). Calls functions:

 testRollbackDeploy
 |-- logInToPaas
 `-- pipeline.sh/parsePipelineDescriptor

Called by:

 test_rollback_deploy.sh/Script-Body

_Environment variables used:_ pipeline.sh -> OUTPUT_FOLDER [big]*//* pipeline.sh -> PROJECT_NAME


pipeline-ansible.sh(1)
======================
:compat-mode!:

NAME
----
pipeline-ansible.sh - a shell script

SYNOPSIS
--------
Documentation automatically generated with `zshelldoc'

FUNCTIONS
---------

 __ansible_inventory
 __ansible_playbook
 completeSwitchOver
 logInToPaas
 prepareForE2eTests
 prepareForSmokeTests
 prodDeploy
 rollbackToPreviousVersion
 stageDeploy
 testDeploy
 testRollbackDeploy

DETAILS
-------

Script Body
~~~~~~~~~~~

Has 10 line(s). No functions are called (may set up e.g. a hook, a Zle widget bound to a key, etc.).

__ansible_inventory
~~~~~~~~~~~~~~~~~~~

Has 8 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

_Environment variables used:_ test_smoke.sh -> ENVIRONMENT

__ansible_playbook
~~~~~~~~~~~~~~~~~~

Has 19 line(s). Doesn't call other functions.

Called by:

 completeSwitchOver
 prodDeploy
 rollbackToPreviousVersion
 stageDeploy
 testDeploy
 testRollbackDeploy

_Environment variables used:_ test_smoke.sh -> ENVIRONMENT

completeSwitchOver
~~~~~~~~~~~~~~~~~~

Has 5 line(s). Calls functions:

 completeSwitchOver
 `-- __ansible_playbook

Called by:

 prod_complete.sh/Script-Body

_Environment variables used:_ pipeline.sh -> LANGUAGE_TYPE

logInToPaas
~~~~~~~~~~~

Has 1 line(s). Doesn't call other functions.

Not called by script or any function (may be e.g. a hook, a Zle widget, etc.).

prepareForE2eTests
~~~~~~~~~~~~~~~~~~

Has 9 line(s). Doesn't call other functions.

Uses feature(s): _export_

Called by:

 stage_e2e.sh/Script-Body

_List of exports (to environment):_ APPLICATION_URL

prepareForSmokeTests
~~~~~~~~~~~~~~~~~~~~

Has 14 line(s). Doesn't call other functions.

Uses feature(s): _export_

Called by:

 testRollbackDeploy
 test_rollback_smoke.sh/Script-Body
 test_smoke.sh/Script-Body

_List of exports (to environment):_ APPLICATION_URL [big]*//* STUBRUNNER_URL

prodDeploy
~~~~~~~~~~

Has 7 line(s). Calls functions:

 prodDeploy
 `-- __ansible_playbook

Called by:

 prod_deploy.sh/Script-Body

_Environment variables used:_ pipeline.sh -> LANGUAGE_TYPE

rollbackToPreviousVersion
~~~~~~~~~~~~~~~~~~~~~~~~~

Has 4 line(s). Calls functions:

 rollbackToPreviousVersion
 `-- __ansible_playbook

Called by:

 prod_rollback.sh/Script-Body

_Environment variables used:_ pipeline.sh -> LANGUAGE_TYPE

stageDeploy
~~~~~~~~~~~

Has 6 line(s). Calls functions:

 stageDeploy
 `-- __ansible_playbook

Called by:

 stage_deploy.sh/Script-Body

_Environment variables used:_ pipeline.sh -> LANGUAGE_TYPE

testDeploy
~~~~~~~~~~

Has 15 line(s). Calls functions:

 testDeploy
 `-- __ansible_playbook

Called by:

 test_deploy.sh/Script-Body

_Environment variables used:_ pipeline.sh -> LANGUAGE_TYPE

testRollbackDeploy
~~~~~~~~~~~~~~~~~~

Has 21 line(s). Calls functions:

 testRollbackDeploy
 |-- __ansible_playbook
 `-- prepareForSmokeTests

Called by:

 test_rollback_deploy.sh/Script-Body

_Environment variables used:_ pipeline-cf.sh -> APPLICATION_URL [big]*//* pipeline-cf.sh -> STUBRUNNER_URL [big]*//* pipeline.sh -> LANGUAGE_TYPE [big]*//* pipeline.sh -> OUTPUT_FOLDER


build_and_upload.sh(1)
======================
:compat-mode!:

NAME
----
build_and_upload.sh - a shell script

SYNOPSIS
--------

Executes a build of the project. Sources pipeline.sh


FUNCTIONS
---------


DETAILS
-------

Script Body
~~~~~~~~~~~

Has 13 line(s). Calls functions:

 Script-Body
 `-- pipeline.sh/build

Uses feature(s): _export_, _source_

_Exports (environment):_ ENVIRONMENT


test_deploy.sh(1)
=================
:compat-mode!:

NAME
----
test_deploy.sh - a shell script

SYNOPSIS
--------

Deploys app to test environment. Sources pipeline.sh


FUNCTIONS
---------


DETAILS
-------

Script Body
~~~~~~~~~~~

Has 13 line(s). Calls functions:

 Script-Body
 |-- pipeline-cf.sh/testDeploy
 `-- pipeline.sh/testDeploy

Uses feature(s): _export_, _source_

_Exports (environment):_ ENVIRONMENT


test_smoke.sh(1)
================
:compat-mode!:

NAME
----
test_smoke.sh - a shell script

SYNOPSIS
--------

Runs smoke tests on the test environment. Sources pipeline.sh


FUNCTIONS
---------


DETAILS
-------

Script Body
~~~~~~~~~~~

Has 14 line(s). Calls functions:

 Script-Body
 |-- pipeline-cf.sh/prepareForSmokeTests
 |-- pipeline.sh/prepareForSmokeTests
 `-- pipeline.sh/runSmokeTests

Uses feature(s): _export_, _source_

_Exports (environment):_ ENVIRONMENT


test_rollback_deploy.sh(1)
==========================
:compat-mode!:

NAME
----
test_rollback_deploy.sh - a shell script

SYNOPSIS
--------

If applicable, deploys current prod version to test environment.
Sources pipeline.sh


FUNCTIONS
---------


DETAILS
-------

Script Body
~~~~~~~~~~~

Has 19 line(s). Calls functions:

 Script-Body
 |-- pipeline-cf.sh/testRollbackDeploy
 `-- pipeline.sh/testRollbackDeploy

Uses feature(s): _export_, _source_

_Exports (environment):_ ENVIRONMENT


test_rollback_smoke.sh(1)
=========================
:compat-mode!:

NAME
----
test_rollback_smoke.sh - a shell script

SYNOPSIS
--------

If applicable, runs smoke tests on the test environment.
Sources pipeline.sh


FUNCTIONS
---------


DETAILS
-------

Script Body
~~~~~~~~~~~

Has 21 line(s). Calls functions:

 Script-Body
 |-- pipeline-cf.sh/prepareForSmokeTests
 |-- pipeline.sh/prepareForSmokeTests
 `-- pipeline.sh/runSmokeTests

Uses feature(s): _export_, _source_

_Exports (environment):_ ENVIRONMENT


stage_deploy.sh(1)
==================
:compat-mode!:

NAME
----
stage_deploy.sh - a shell script

SYNOPSIS
--------

Deploys app to stage environment. Sources pipeline.sh


FUNCTIONS
---------


DETAILS
-------

Script Body
~~~~~~~~~~~

Has 13 line(s). Calls functions:

 Script-Body
 |-- pipeline-cf.sh/stageDeploy
 `-- pipeline.sh/stageDeploy

Uses feature(s): _export_, _source_

_Exports (environment):_ ENVIRONMENT


stage_e2e.sh(1)
===============
:compat-mode!:

NAME
----
stage_e2e.sh - a shell script

SYNOPSIS
--------

Runs end to end tests on stage. Sources pipeline.sh


FUNCTIONS
---------


DETAILS
-------

Script Body
~~~~~~~~~~~

Has 14 line(s). Calls functions:

 Script-Body
 |-- pipeline-cf.sh/prepareForE2eTests
 |-- pipeline.sh/prepareForE2eTests
 `-- pipeline.sh/runE2eTests

Uses feature(s): _export_, _source_

_Exports (environment):_ ENVIRONMENT


prod_deploy.sh(1)
=================
:compat-mode!:

NAME
----
prod_deploy.sh - a shell script

SYNOPSIS
--------

Deploys app to production. Sources pipeline.sh


FUNCTIONS
---------


DETAILS
-------

Script Body
~~~~~~~~~~~

Has 13 line(s). Calls functions:

 Script-Body
 |-- pipeline-cf.sh/prodDeploy
 `-- pipeline.sh/prodDeploy

Uses feature(s): _export_, _source_

_Exports (environment):_ ENVIRONMENT


prod_complete.sh(1)
===================
:compat-mode!:

NAME
----
prod_complete.sh - a shell script

SYNOPSIS
--------

Executes a switch over of the traffic, fully to the new instance.
Sources pipeline.sh


FUNCTIONS
---------


DETAILS
-------

Script Body
~~~~~~~~~~~

Has 13 line(s). Calls functions:

 Script-Body
 |-- pipeline-cf.sh/completeSwitchOver
 `-- pipeline.sh/completeSwitchOver

Uses feature(s): _export_, _source_

_Exports (environment):_ ENVIRONMENT


prod_rollback.sh(1)
===================
:compat-mode!:

NAME
----
prod_rollback.sh - a shell script

SYNOPSIS
--------

Rolls back app from production. Sources pipeline.sh


FUNCTIONS
---------


DETAILS
-------

Script Body
~~~~~~~~~~~

Has 19 line(s). Calls functions:

 Script-Body
 |-- pipeline-cf.sh/rollbackToPreviousVersion
 |-- pipeline.sh/removeProdTag
 `-- pipeline.sh/rollbackToPreviousVersion

Uses feature(s): _export_, _source_

_Exports (environment):_ ENVIRONMENT
