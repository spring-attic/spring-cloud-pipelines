<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>10.&nbsp;Jenkins Pipeline (Cloud Foundry)</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="multi_spring-cloud-pipelines.html" title="Spring Cloud Pipelines"><link rel="up" href="multi__spring_cloud_pipelines.html" title="Part&nbsp;I.&nbsp;Spring Cloud Pipelines"><link rel="prev" href="multi__jenkins_pipeline_common.html" title="9.&nbsp;Jenkins Pipeline (Common)"><link rel="next" href="multi_jenkins-pipeline-k8s.html" title="11.&nbsp;Jenkins Pipeline (Kubernetes)"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">10.&nbsp;Jenkins Pipeline (Cloud Foundry)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="multi__jenkins_pipeline_common.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;I.&nbsp;Spring Cloud Pipelines</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="multi_jenkins-pipeline-k8s.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="jenkins-pipeline-cf" href="#jenkins-pipeline-cf"></a>10.&nbsp;Jenkins Pipeline (Cloud Foundry)</h2></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>In this chapter, we assume that you deploy your application
to Cloud Foundry PaaS.</p></td></tr></table></div><p><a name="jenkins" href="#jenkins"></a> The Spring Cloud Pipelines repository contains job definitions and the opinionated setup pipeline, which uses the <a class="link" href="https://wiki.jenkins-ci.org/display/JENKINS/Job+DSL+Plugin" target="_top">Jenkins Job DSL plugin</a>. Those jobs form an empty pipeline and a opinionated sample pipeline that you can use in your company.</p><p>The following projects take part in the <code class="literal">microservice setup</code> for this demo.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-analytics" target="_top">Github Analytics</a>: The app that has a REST endpoint and uses messaging&#8201;&#8212;&#8201;part off our business application.</li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-webhook" target="_top">Github Webhook</a>: Project that emits messages that are used by Github Analytics&#8201;&#8212;&#8201;part of our business application.</li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-eureka" target="_top">Eureka</a>: Simple Eureka Server. This is an infrastructure application.</li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-analytics-stub-runner-boot" target="_top">Github Analytics Stub Runner Boot</a>: Stub Runner Boot server to be used for tests with Github Analytics and using Eureka and Messaging. This is an infrastructure application.</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="step-by-step-cf" href="#step-by-step-cf"></a>10.1&nbsp;Step-by-step</h2></div></div></div><p>This is a guide for the Jenkins Job DSL based pipeline.</p><p>If you want only to run the demo as far as possible using PCF Dev and Docker Compose, do the following:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><a class="link" href="multi_jenkins-pipeline-cf.html#jenkins-fork-cf">Fork Repositories</a></li><li class="listitem"><a class="link" href="multi_jenkins-pipeline-cf.html#jenkins-start-cf">Start Jenkins and Artifactory</a></li><li class="listitem"><a class="link" href="multi_jenkins-pipeline-cf.html#jenkins-deploy-cf">Deploy infra to Artifactory</a></li><li class="listitem"><a class="link" href="multi_jenkins-pipeline-cf.html#jenkins-pcfdev-cf">Start PCF Dev (if you do not want to use an existing one)</a></li><li class="listitem"><a class="link" href="multi_jenkins-pipeline-cf.html#jenkins-seed-cf" title="10.1.4&nbsp;Run the Seed Job">Run the Seed Job</a></li><li class="listitem"><a class="link" href="multi_jenkins-pipeline-cf.html" title="10.&nbsp;Jenkins Pipeline (Cloud Foundry)">Run the <code class="literal">github-webhook</code> Pipeline</a></li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="fork-repos-cf" href="#fork-repos-cf"></a>10.1.1&nbsp;Fork Repositories</h3></div></div></div><p><a name="jenkins-fork-cf" href="#jenkins-fork-cf"></a>Four applications compose the pipeline:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-webhook" target="_top">Github Webhook</a></li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-analytics/" target="_top">Github Analytics</a></li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-eureka" target="_top">Github Eureka</a></li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-analytics-stub-runner-boot" target="_top">Github Stub Runner Boot</a></li></ul></div><p>You need to fork only the following, because only then can you tag and push the tag to your repository:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-webhook" target="_top">Github Webhook</a></li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-analytics/" target="_top">Github Analytics</a></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="start-jenkins-cf" href="#start-jenkins-cf"></a>10.1.2&nbsp;Start Jenkins and Artifactory</h3></div></div></div><p><a name="jenkins-start-cf" href="#jenkins-start-cf"></a>Jenkins + Artifactory can be ran locally. To do so, run the
<code class="literal">start.sh</code> script from this repository. The following listing shows the script:</p><div class="informalexample"><pre class="programlisting">git clone https://github.com/spring-cloud/spring-cloud-pipelines
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">cd</span> spring-cloud-pipelines/jenkins
./start.sh yourGitUsername yourGitPassword yourForkedGithubOrg</pre></div><p>Then Jenkins runs on port <code class="literal">8080</code>, and Artifactory runs on port <code class="literal">8081</code>.
The parameters are passed as environment variables to the Jenkins VM,
and credentials are set. That way, you need not do
any manual work on the Jenkins side. In the above parameters, the third parameter
could be <code class="literal">yourForkedGithubOrg</code> or <code class="literal">yourGithubUsername</code>. Also the <code class="literal">REPOS</code> environment variable
contains your GitHub org (in which you have the forked repos).</p><p>Instead of the Git username and password parameters, you could pass <code class="literal">-key &lt;path_to_private_key&gt;</code>
(if you prefer to use key-based authentication with your Git repositories).</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="deploy-infra-cf" href="#deploy-infra-cf"></a>Deploy the Infra JARs to Artifactory</h4></div></div></div><p><a name="jenkins-deploy-cf" href="#jenkins-deploy-cf"></a>When Artifactory is running, run the <code class="literal">tools/deploy-infra.sh</code> script from this repo. The following listing shows the script:</p><div class="informalexample"><pre class="programlisting">git clone https://github.com/spring-cloud/spring-cloud-pipelines
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">cd</span> spring-cloud-pipelines/
./tools/deploy-infra.sh</pre></div><p>As a result, both the <code class="literal">eureka</code> and <code class="literal">stub runner</code> repositories are cloned, built,
and uploaded to Artifactory.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="start-pcf-dev-cf" href="#start-pcf-dev-cf"></a>10.1.3&nbsp;Start PCF Dev</h3></div></div></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You can skip this step if you have CF installed and do not want to use PCF Dev.
In that case, the only thing you have to do is to set up spaces.</p></td></tr></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>Servers often run run out of resources at the stage step.
If that happens <a class="link" href="">clear some apps from PCF Dev and continue</a>.</p></td></tr></table></div><p><a name="jenkins-pcfdev-cf" href="#jenkins-pcfdev-cf"></a>You have to download and start PCF Dev, as described <a class="link" href="https://pivotal.io/platform/pcf-tutorials/getting-started-with-pivotal-cloud-foundry-dev/install-pcf-dev" target="_top">here.</a></p><p>The default credentials when using PCF Dev are as follows:</p><div class="informalexample"><pre class="programlisting">username: user
password: pass
email: user
org: pcfdev-org
space: pcfdev-space
api: api.local.pcfdev.io</pre></div><p>You can start PCF Dev as follows:</p><div class="informalexample"><pre class="programlisting">cf dev start</pre></div><p>You must create three separate spaces, as follows:</p><div class="informalexample"><pre class="programlisting">cf login -a https://api.local.pcfdev.io --skip-ssl-validation -u admin -p admin -o pcfdev-org

cf create-space pcfdev-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>
cf <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">set</span>-space-role user pcfdev-org pcfdev-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span> SpaceDeveloper
cf create-space pcfdev-stage
cf <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">set</span>-space-role user pcfdev-org pcfdev-stage SpaceDeveloper
cf create-space pcfdev-prod
cf <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">set</span>-space-role user pcfdev-org pcfdev-prod SpaceDeveloper</pre></div><p>You can also run the <code class="literal">./tools/cf-helper.sh setup-spaces</code> script to do this.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jenkins-seed-cf" href="#jenkins-seed-cf"></a>10.1.4&nbsp;Run the Seed Job</h3></div></div></div><p>We created the seed job for you, but you have to run it. When you do
run it, you have to provide some properties. By default we create a seed that
has all the properties options, but you can delete most of it. If you
set the properties as global environment variables, you have to remove them from the
seed.</p><p>To run the demo, provide a comma-separated
list of the URLs of the two aforementioned forks (<code class="literal">github-webhook</code> and <code class="literal">github-analytics') in the `REPOS</code> variable.</p><p>The following images shows the steps involved:</p><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e5912" href="#d0e5912"></a><p class="title"><b>Figure&nbsp;10.1.&nbsp;Click the 'jenkins-pipeline-seed-cf' job for Cloud Foundry and <code class="literal">jenkins-pipeline-seed-k8s</code> for Kubernetes</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/seed_click.png" alt="seed click"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e5926" href="#d0e5926"></a><p class="title"><b>Figure&nbsp;10.2.&nbsp;Click the 'Build with parameters'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/seed_run.png" alt="seed run"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e5937" href="#d0e5937"></a><p class="title"><b>Figure&nbsp;10.3.&nbsp;The <code class="literal">REPOS</code> parameter should already contain your forked repos (you&#8217;ll have more properties than the ones in the screenshot)</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/seed.png" alt="seed"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e5951" href="#d0e5951"></a><p class="title"><b>Figure&nbsp;10.4.&nbsp;This is how the results of seed should look like</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/seed_built.png" alt="seed built"></div></div></div><br class="figure-break"></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jenkins-pipeline-cf" href="#jenkins-pipeline-cf"></a>10.1.5&nbsp;Run the <code class="literal">github-webhook</code> Pipeline</h3></div></div></div><p>We already created the seed job for you, but you have to run it. When you do
run it, you have to provide some properties. By default, we create a seed that
has all the properties options, but you can delete most of it. If you
set the properties as global environment variables, you have to remove them from the
seed.</p><p>To run the demo, provide a comma-separated
 list of URLs of the two aforementioned forks (<code class="literal">github-webhook</code> and <code class="literal">github-analytics</code>) in the <code class="literal">REPOS</code> variable.</p><p>The following images shows the steps involved:</p><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e5983" href="#d0e5983"></a><p class="title"><b>Figure&nbsp;10.5.&nbsp;Click the 'github-webhook' view</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/seed_views.png" alt="seed views"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e5994" href="#d0e5994"></a><p class="title"><b>Figure&nbsp;10.6.&nbsp;Run the pipeline</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/pipeline_run.png" alt="pipeline run"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>If your build fails on <span class="strong"><strong>deploy previous version to stage</strong></span> due to a missing jar,
that means that you forgot to clear the tags in your repository. Typically, that happens because
you removed the Artifactory volume with a deployed jar while a tag in the repository still points there.
See <a class="link" href="">here</a> for how to remove the tag.</p></td></tr></table></div><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e6016" href="#d0e6016"></a><p class="title"><b>Figure&nbsp;10.7.&nbsp;Click the manual step to go to stage (remember about killing the apps on test env). To do this click the <span class="strong">ARROW</span> next to the job name</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/pipeline_manual.png" alt="pipeline manual"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Servers often run run out of resources at the stage step.
For that reason, we suggest killing all applications on test. See the <a class="link" href="">FAQ</a> for more detail.</p></td></tr></table></div><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e6038" href="#d0e6038"></a><p class="title"><b>Figure&nbsp;10.8.&nbsp;The full pipeline should look like this</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/pipeline_finished.png" alt="pipeline finished"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="declarative-pipeline-cf" href="#declarative-pipeline-cf"></a>10.2&nbsp;Declarative Pipeline &amp; Blue Ocean</h2></div></div></div><p>You can also use the <a class="link" href="https://jenkins.io/doc/book/pipeline/syntax/" target="_top">declarative pipeline</a> approach with the
<a class="link" href="https://jenkins.io/projects/blueocean/" target="_top">Blue Ocean UI</a>.</p><p>The Blue Ocean UI is available under the <code class="literal">blue/</code> URL (for example, for Docker Machine-based setup: <code class="literal"><a class="link" href="https://192.168.99.100:8080/blue" target="_top">https://192.168.99.100:8080/blue</a></code>).</p><p>The following images show the various steps involved:</p><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e6073" href="#d0e6073"></a><p class="title"><b>Figure&nbsp;10.9.&nbsp;Open Blue Ocean UI and click on <code class="literal">github-webhook-declarative-pipeline</code></b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/blue_1.png" alt="blue 1"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e6086" href="#d0e6086"></a><p class="title"><b>Figure&nbsp;10.10.&nbsp;Your first run will look like this. Click <code class="literal">Run</code> button</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/blue_2.png" alt="blue 2"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e6100" href="#d0e6100"></a><p class="title"><b>Figure&nbsp;10.11.&nbsp;Enter parameters required for the build and click <code class="literal">run</code></b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/blue_3.png" alt="blue 3"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e6113" href="#d0e6113"></a><p class="title"><b>Figure&nbsp;10.12.&nbsp;A list of pipelines will be shown. Click your first run.</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/blue_4.png" alt="blue 4"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e6124" href="#d0e6124"></a><p class="title"><b>Figure&nbsp;10.13.&nbsp;State if you want to go to production or not and click <code class="literal">Proceed</code></b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/blue_5.png" alt="blue 5"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e6137" href="#d0e6137"></a><p class="title"><b>Figure&nbsp;10.14.&nbsp;The build is in progress&#8230;&#8203;</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/blue_6.png" alt="blue 6"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e6148" href="#d0e6148"></a><p class="title"><b>Figure&nbsp;10.15.&nbsp;The pipeline is done!</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/blue_7.png" alt="blue 7"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>There is no possibility of restarting a pipeline from a specific stage after failure.
See <a class="link" href="https://issues.jenkins-ci.org/browse/JENKINS-33846" target="_top">this issue</a> for more information</p></td></tr></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>Currently, there is no way to introduce manual steps in a performant way. Jenkins
blocks an executor when a manual step is required. That means that you run out of executors
pretty quickly. See <a class="link" href="https://issues.jenkins-ci.org/browse/JENKINS-36235" target="_top">this issue</a>
and <a class="link" href="https://stackoverflow.com/questions/42561241/how-to-wait-for-user-input-in-a-declarative-pipeline-without-blocking-a-heavywei" target="_top">this StackOverflow question</a>
for more information.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="optional-steps-cf" href="#optional-steps-cf"></a>10.3&nbsp;Jenkins Cloud Foundry Customization</h2></div></div></div><p>You can customize Jenkins for Cloud Foundry by setting a variety of environment variables.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You need not see all the environment variables described in this section to run the demo. They are needed only
when you want to make custom changes.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="all-env-vars-cf" href="#all-env-vars-cf"></a>10.3.1&nbsp;Environment Variable Summary</h3></div></div></div><p>The environment variables that are used in all of the jobs are as follows:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Property Name</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Property Description</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Default value</th></tr></thead><tfoot><tr><th style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">BINARY_EXTENSION</code></p></th><th style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Extension of the binary uploaded to Artifactory / Nexus. Example: <code class="literal">war</code> for WAR artifacts</p></th><th style="" align="left" valign="top"><p><code class="literal">jar</code></p></th></tr></tfoot><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PAAS_TEST_API_URL</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The URL to the CF API for the TEST environment</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">api.local.pcfdev.io</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PAAS_STAGE_API_URL</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The URL to the CF API for the STAGE environment</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">api.local.pcfdev.io</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PAAS_PROD_API_URL</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The URL to the CF API for the PROD environment</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">api.local.pcfdev.io</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PAAS_TEST_ORG</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the org for the test env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">pcfdev-org</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PAAS_TEST_SPACE_PREFIX</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Prefix of the name of the CF space for the test environment to which the app name is appended</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">sc-pipelines-test</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PAAS_STAGE_ORG</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the org for the stage environment</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">pcfdev-org</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PAAS_STAGE_SPACE</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the space for the stage environment</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">sc-pipelines-stage</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PAAS_PROD_ORG</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the org for the prod environment</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">pcfdev-org</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PAAS_PROD_SPACE</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the space for the prod environment</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">sc-pipelines-prod</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">REPO_WITH_BINARIES_FOR_UPLOAD</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>URL of the repository with the deployed jars</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal"><a class="link" href="https://artifactory:8081/artifactory/libs-release-local" target="_top">https://artifactory:8081/artifactory/libs-release-local</a></code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">M2_SETTINGS_REPO_ID</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The ID of server from Maven <code class="literal">settings.xml</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">artifactory-local</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">JDK_VERSION</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The name of the JDK installation</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">jdk8</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PIPELINE_VERSION</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The version of the pipeline (ultimately, also the version of the jar)</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">1.0.0.M1-${GROOVY,script ="new Date().format('yyMMdd_HHmmss')"}-VERSION</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">GIT_EMAIL</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The email used by Git to tag the repository</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">email@example.com</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">GIT_NAME</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The name used by Git to tag the repository</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">Pivo Tal</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PAAS_HOSTNAME_UUID</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Additional suffix for the route. In a shared environment, the default routes can be already taken</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">AUTO_DEPLOY_TO_STAGE</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Whether deployment to stage be automatic</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">false</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">AUTO_DEPLOY_TO_PROD</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Whether deployment to prod be automatic</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">false</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">API_COMPATIBILITY_STEP_REQUIRED</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Whether the API compatibility step is required</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">true</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">DB_ROLLBACK_STEP_REQUIRED</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Whether the DB rollback step is present</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">true</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">DEPLOY_TO_STAGE_STEP_REQUIRED</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Whether to the deploy-to-stage step be present</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">true</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">BUILD_OPTIONS</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Additional options you would like to pass to the Maven / Gradle build</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jenkins-credentials-cf" href="#jenkins-credentials-cf"></a>10.3.2&nbsp;Jenkins Credentials</h3></div></div></div><p>Our scripts reference the credentials by IDs. The following table describes the defaults for the credentials:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Property Name</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Property Description</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Default value</th></tr></thead><tfoot><tr><th style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PAAS_PROD_CREDENTIAL_ID</code></p></th><th style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Credential ID for CF Prod environment access</p></th><th style="" align="left" valign="top"><p><code class="literal">cf-prod</code></p></th></tr></tfoot><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">GIT_CREDENTIAL_ID</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Credential ID used to tag a Git repo</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">git</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">GIT_SSH_CREDENTIAL_ID</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>SSH credential ID used to tag a Git repo</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">gitSsh</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">GIT_USE_SSH_KEY</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>If <code class="literal">true</code>, pick the SSH credential id to use</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">false</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">REPO_WITH_BINARIES_CREDENTIAL_ID</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Credential ID used for the repository with jars</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">repo-with-binaries</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PAAS_TEST_CREDENTIAL_ID</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Credential ID for CF Test environment access</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">cf-test</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PAAS_STAGE_CREDENTIAL_ID</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Credential ID for CF Stage environment access</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">cf-stage</code></p></td></tr></tbody></table></div><p>If you already have in your system a credential to (for example) tag a repository,
you can use it by passing the value of the <code class="literal">GIT_CREDENTIAL_ID</code> property.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>See the <code class="literal">cf-helper</code> script for all the configuration options.</p></td></tr></table></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="multi__jenkins_pipeline_common.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="multi__spring_cloud_pipelines.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="multi_jenkins-pipeline-k8s.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">9.&nbsp;Jenkins Pipeline (Common)&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="multi_spring-cloud-pipelines.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;11.&nbsp;Jenkins Pipeline (Kubernetes)</td></tr></table></div></body></html>