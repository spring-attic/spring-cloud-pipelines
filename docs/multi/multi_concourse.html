<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>4.&nbsp;Concourse Pipeline</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="multi_spring-cloud-pipelines.html" title="Spring Cloud Pipelines"><link rel="up" href="multi_spring-cloud-pipelines.html" title="Spring Cloud Pipelines"><link rel="prev" href="multi__project_opinions.html" title="3.&nbsp;Project opinions"><link rel="next" href="multi__jenkins_pipeline_common.html" title="5.&nbsp;Jenkins Pipeline (Common)"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.&nbsp;Concourse Pipeline</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="multi__project_opinions.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="multi__jenkins_pipeline_common.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="concourse" href="#concourse"></a>4.&nbsp;Concourse Pipeline</h1></div></div></div><p>The repository contains an opinionated pipeline that will build and deploy  - <a class="link" href="https://github.com/spring-cloud-samples/github-webhook" target="_top">Github Webhook</a> application.</p><p>All in all there are the following projects taking part in the whole <code class="literal">microservice setup</code> for this demo.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-analytics" target="_top">Github-Analytics</a> - the app that has a REST endpoint and uses messaging. Our business application.</li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-webhook" target="_top">Github Webhook</a> - project that emits messages that are used by Github Analytics. Our business application.</li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-eureka" target="_top">Eureka</a> - simple Eureka Server. This is an infrastructure application.</li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-analytics-stub-runner-boot" target="_top">Github Analytics Stub Runner Boot</a> - Stub Runner Boot server to be used for tests with Github Analytics. Uses Eureka and Messaging. This is an infrastructure application.</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_step_by_step" href="#_step_by_step"></a>4.1&nbsp;Step by step</h2></div></div></div><p>If you want to just run the demo as far as possible using PCF Dev and Docker Compose</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="multi_concourse.html#fork">Fork repos</a></li><li class="listitem"><a class="link" href="multi_concourse.html#start">Start Concourse and Artifactory</a></li><li class="listitem"><a class="link" href="multi_concourse.html#deploy">Deploy infra to Artifactory</a></li><li class="listitem"><a class="link" href="multi_concourse.html#pcfdev">Start PCF Dev (if you don&#8217;t want to use an existing one)</a></li><li class="listitem"><a class="link" href="multi_concourse.html#fly">Setup the <code class="literal">fly</code> CLI</a></li><li class="listitem"><a class="link" href="multi_concourse.html#creds">Setup your <code class="literal">credentials.yml</code></a></li><li class="listitem"><a class="link" href="">Run the seed job</a></li><li class="listitem"><a class="link" href="">Run the <code class="literal">github-webhook</code> pipeline</a></li></ul></div><p>Below you can find <a class="link" href="">optional</a> steps needed to be taken when you want to customize the pipeline</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="">Setup Jenkins env vars (if you want to use the demo defaults and you&#8217;re using Docker Machine
just check out the section on how to update the URL to Artifactory)</a></li><li class="listitem"><a class="link" href="">Add <code class="literal">settings.xml</code> for Jenkins' master (you can skip this if you want to use our defaults)</a></li><li class="listitem"><a class="link" href="">Setup Jenkins miscs (JDK installation, Groovy macro processing etc.)</a></li><li class="listitem"><a class="link" href="">Setup Jenkins credentials</a></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_fork_repos" href="#_fork_repos"></a>4.1.1&nbsp;Fork repos</h3></div></div></div><p><a name="fork" href="#fork"></a> There are 4 apps that are composing the pipeline</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-webhook" target="_top">Github Webhook</a></li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-analytics/" target="_top">Github Analytics</a></li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-eureka" target="_top">Github Eureka</a></li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-analytics-stub-runner-boot" target="_top">Github Stub Runner Boot</a></li></ul></div><p>You need to fork only these. That&#8217;s because only then will your user be able to tag and push the tag to repo.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-webhook" target="_top">Github Webhook</a></li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-analytics/" target="_top">Github Analytics</a></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_start_concourse_and_artifactory" href="#_start_concourse_and_artifactory"></a>4.1.2&nbsp;Start Concourse and Artifactory</h3></div></div></div><p><a name="start" href="#start"></a> Concourse + Artifactory can be run locally. To do that just execute the
<code class="literal">start.sh</code> script from this repo.</p><pre class="programlisting">git clone https://github.com/spring-cloud/spring-cloud-pipelines
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">cd</span> spring-cloud-pipelines/concourse
./setup_docker_compose.sh
./start.sh <span class="hl-number">192.168</span>.<span class="hl-number">99.100</span></pre><p>The <code class="literal">setup_docker_compose.sh</code> script should be executed once only to allow
generation of keys.</p><p>The <code class="literal">192.168.99.100</code> param is an example of an external URL of Concourse
(equal to Docker-Machine ip in this example).</p><p>Then Concourse will be running on port <code class="literal">8080</code> and Artifactory <code class="literal">8081</code>.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_deploy_the_infra_jars_to_artifactory" href="#_deploy_the_infra_jars_to_artifactory"></a>Deploy the infra JARs to Artifactory</h4></div></div></div><p><a name="deploy" href="#deploy"></a> When Artifactory is running, just execute the <code class="literal">tools/deploy-infra.sh</code> script from this repo.</p><pre class="programlisting">git clone https://github.com/spring-cloud/spring-cloud-pipelines
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">cd</span> spring-cloud-pipelines/
./tools/deploy-infra.sh</pre><p>As a result both <code class="literal">eureka</code> and <code class="literal">stub runner</code> repos will be cloned, built
and uploaded to Artifactory.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_start_pcf_dev" href="#_start_pcf_dev"></a>4.1.3&nbsp;Start PCF Dev</h3></div></div></div><p><a name="pcfdev" href="#pcfdev"></a> TIP: You can skip this step if you have CF installed and don&#8217;t want to use PCF Dev
The only thing you have to do is to set up spaces.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>It&#8217;s more than likely that you&#8217;ll run out of resources when you reach stage step.
Don&#8217;t worry! Keep calm and <a class="link" href="multi_concourse.html#resources">clear some apps from PCF Dev and continue</a>.</p></td></tr></table></div><p>You have to download and start PCF Dev. <a class="link" href="https://pivotal.io/platform/pcf-tutorials/getting-started-with-pivotal-cloud-foundry-dev/install-pcf-dev" target="_top">A link how to do it is available here.</a></p><p>The default credentials when using PCF Dev are:</p><pre class="programlisting">username: user
password: pass
email: user
org: pcfdev-org
space: pcfdev-space
api: api.local.pcfdev.io</pre><p>You can start the PCF dev like this:</p><pre class="programlisting">cf dev start</pre><p>You&#8217;ll have to create 3 separate spaces (email admin, pass admin)</p><pre class="programlisting">cf login -a https://api.local.pcfdev.io --skip-ssl-validation -u admin -p admin -o pcfdev-org

cf create-space pcfdev-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>
cf <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">set</span>-space-role user pcfdev-org pcfdev-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span> SpaceDeveloper
cf create-space pcfdev-stage
cf <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">set</span>-space-role user pcfdev-org pcfdev-stage SpaceDeveloper
cf create-space pcfdev-prod
cf <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">set</span>-space-role user pcfdev-org pcfdev-prod SpaceDeveloper</pre><p>You can also execute the <code class="literal">./tools/cf-helper.sh setup-spaces</code> to do this.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_setup_the_literal_fly_literal_cli" href="#_setup_the_literal_fly_literal_cli"></a>4.1.4&nbsp;Setup the <code class="literal">fly</code> CLI</h3></div></div></div><p><a name="fly" href="#fly"></a> If you go to Concourse website you should see sth like this:</p><p>&nbsp;
&nbsp;</p><div class="informalfigure"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/concourse/running_concourse.png" alt="running concourse"></div></div><p>&nbsp;
&nbsp;</p><p>You can click one of the icons (depending on your OS) to download <code class="literal">fly</code>, which is the Concourse CLI. Once you&#8217;ve downloaded that (and maybe added to your PATH) you can run:</p><pre class="programlisting">fly --version</pre><p>If <code class="literal">fly</code> is properly installed then it should print out the version.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_setup_your_literal_credentials_yml_literal" href="#_setup_your_literal_credentials_yml_literal"></a>4.1.5&nbsp;Setup your <code class="literal">credentials.yml</code></h3></div></div></div><p><a name="creds" href="#creds"></a> The repo comes with <code class="literal">credentials-sample.yml</code> which is set up with sample data (most credentials) are set to be applicable for PCF Dev. Copy this file to a new file <code class="literal">credentials.yml</code> (the file is added to .gitignore so don&#8217;t worry that you&#8217;ll push it with your passwords) and edit it as you wish. For our demo jus setup:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">app-url</code> - url pointing to your forked <code class="literal">github-webhook</code> repo</li><li class="listitem"><code class="literal">github-private-key</code> - your private key to clone / tag GitHub repos</li><li class="listitem"><code class="literal">repo-with-binaries</code> - the IP is set to the defaults for Docker Machine. You should update it to point to your setup</li></ul></div><p>If you don&#8217;t have a Docker Machine just execute <code class="literal">./whats_my_ip.sh</code> script to
get an external IP that you can pass to your <code class="literal">repo-with-binaries</code> instead of the default
Docker Machine IP.</p><p>Below you can see what environment variables are required by the scripts. To the right hand side you can see the default values for PCF Dev that we set in the <code class="literal">credentials-sample.yml</code>.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Property Name</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Property Description</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Default value</th></tr></thead><tfoot><tr><th style="border-right: 0.5pt solid ; " align="left" valign="top"><p>BUILD_OPTIONS</p></th><th style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Additional options you would like to pass to the Maven / Gradle build</p></th><th style="" align="left" valign="top">&nbsp;</th></tr></tfoot><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_TEST_API_URL</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The URL to the CF Api for TEST env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>api.local.pcfdev.io</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_STAGE_API_URL</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The URL to the CF Api for STAGE env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>api.local.pcfdev.io</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_PROD_API_URL</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The URL to the CF Api for PROD env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>api.local.pcfdev.io</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_TEST_ORG</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the org for the test env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>pcfdev-org</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_TEST_SPACE</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the space for the test env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>pcfdev-space</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_STAGE_ORG</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the org for the stage env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>pcfdev-org</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_STAGE_SPACE</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the space for the stage env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>pcfdev-space</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_PROD_ORG</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the org for the prod env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>pcfdev-org</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_PROD_SPACE</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the space for the prod env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>pcfdev-space</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>REPO_WITH_BINARIES</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>URL to repo with the deployed jars</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://192.168.99.100:8081/artifactory/libs-release-local" target="_top">http://192.168.99.100:8081/artifactory/libs-release-local</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>M2_SETTINGS_REPO_ID</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The id of server from Maven settings.xml</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>artifactory-local</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_HOSTNAME_UUID</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Additional suffix for the route. In a shared environment the default routes can be already taken</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>APP_MEMORY_LIMIT</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>How much memory should be used by the infra apps (Eureka, Stub Runner etc.)</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>256m</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>JAVA_BUILDPACK_URL</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The URL to the Java buildpack to be used by CF</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="https://github.com/cloudfoundry/java-buildpack.git#v3.8.1" target="_top">https://github.com/cloudfoundry/java-buildpack.git#v3.8.1</a></p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_build_the_pipeline" href="#_build_the_pipeline"></a>4.1.6&nbsp;Build the pipeline</h3></div></div></div><p>Log in (e.g. for Concourse running at <code class="literal">192.168.99.100</code> - if you don&#8217;t provide any value then <code class="literal">localhost</code> is assumed). If you execute this script  (it assumes that either <code class="literal">fly</code> is on your <code class="literal">PATH</code> or it&#8217;s in the same folder as the script is):</p><pre class="programlisting">./login.sh <span class="hl-number">192.168</span>.<span class="hl-number">99.100</span></pre><p>Next run the command to create the pipeline.</p><pre class="programlisting">./set_pipeline.sh</pre><p>Then you&#8217;ll create a <code class="literal">github-webhook</code> pipeline under the <code class="literal">docker</code> alias, using the provided <code class="literal">credentials.yml</code> file.
You can override these values in exactly that order (e.g. <code class="literal">./set-pipeline.sh some-project another-target some-other-credentials.yml</code>)</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_run_the_literal_github_webhook_literal_pipeline" href="#_run_the_literal_github_webhook_literal_pipeline"></a>4.1.7&nbsp;Run the <code class="literal">github-webhook</code> pipeline</h3></div></div></div><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e1710" href="#d0e1710"></a><p class="title"><b>Figure&nbsp;4.1.&nbsp;Click <code class="literal">Login</code></b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/concourse/concourse_login.png" alt="concourse login"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e1723" href="#d0e1723"></a><p class="title"><b>Figure&nbsp;4.2.&nbsp;Pick <code class="literal">main</code> team</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/concourse/concourse_team_main.png" alt="concourse team main"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e1737" href="#d0e1737"></a><p class="title"><b>Figure&nbsp;4.3.&nbsp;Log in with <code class="literal">concourse</code> user and <code class="literal">changeme</code> password</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/concourse/concourse_user_pass.png" alt="concourse user pass"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e1754" href="#d0e1754"></a><p class="title"><b>Figure&nbsp;4.4.&nbsp;Your screen should look more or less like this</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/concourse/concourse_pipeline.png" alt="concourse pipeline"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e1765" href="#d0e1765"></a><p class="title"><b>Figure&nbsp;4.5.&nbsp;Unpause the pipeline by clicking in the top lefr corner and then clicking the <code class="literal">play</code> button</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/concourse/start_pipeline.png" alt="start pipeline"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e1779" href="#d0e1779"></a><p class="title"><b>Figure&nbsp;4.6.&nbsp;Click 'generate-version'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/concourse/generate_version.png" alt="generate version"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e1790" href="#d0e1790"></a><p class="title"><b>Figure&nbsp;4.7.&nbsp;Click <code class="literal">+</code> sign to start a new build</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/concourse/run_pipeline.png" alt="run pipeline"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e1804" href="#d0e1804"></a><p class="title"><b>Figure&nbsp;4.8.&nbsp;The job is pending</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/concourse/concourse_pending.png" alt="concourse pending"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e1815" href="#d0e1815"></a><p class="title"><b>Figure&nbsp;4.9.&nbsp;Job is pending in the main screen</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/concourse/job_running.png" alt="job running"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e1826" href="#d0e1826"></a><p class="title"><b>Figure&nbsp;4.10.&nbsp;Job is running in the main screen</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/concourse/running_pipeline.png" alt="running pipeline"></div></div></div><br class="figure-break"></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_faq" href="#_faq"></a>4.2&nbsp;FAQ</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="faq" href="#faq"></a>4.2.1&nbsp;Can I use the pipeline for some other repos?</h3></div></div></div><p>Sure! Just change the <code class="literal">app-url</code> in <code class="literal">credentials.yml</code>!</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_will_this_work_for_any_project_out_of_the_box" href="#_will_this_work_for_any_project_out_of_the_box"></a>4.2.2&nbsp;Will this work for ANY project out of the box?</h3></div></div></div><p>Not really. This is an <code class="literal">opinionated pipeline</code> that&#8217;s why we took some
opinionated decisions like:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">usage of Spring Cloud, Spring Cloud Contract Stub Runner and Spring Cloud Eureka</li><li class="listitem">application deployment to Cloud Foundry</li><li class="listitem"><p class="simpara">For Maven:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">usage of Maven Wrapper</li><li class="listitem">artifacts deployment by <code class="literal">./mvnw clean deploy</code></li><li class="listitem"><code class="literal">stubrunner.ids</code> property to retrieve list of collaborators for which stubs should be downloaded</li><li class="listitem">running smoke tests on a deployed app via the <code class="literal">smoke</code> Maven profile</li><li class="listitem">running end to end tests on a deployed app via the <code class="literal">e2e</code> Maven profile</li></ul></div></li><li class="listitem"><p class="simpara">For Gradle (in the <code class="literal">github-analytics</code> application check the <code class="literal">gradle/pipeline.gradle</code> file):</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">usage of Gradlew Wrapper</li><li class="listitem"><code class="literal">deploy</code> task for artifacts deployment</li><li class="listitem">running smoke tests on a deployed app via the <code class="literal">smoke</code> task</li><li class="listitem">running end to end tests on a deployed app via the <code class="literal">e2e</code> task</li><li class="listitem"><code class="literal">groupId</code> task to retrieve group id</li><li class="listitem"><code class="literal">artifactId</code> task to retrieve artifact id</li><li class="listitem"><code class="literal">currentVersion</code> task to retrieve the current version</li><li class="listitem"><code class="literal">stubIds</code> task to retrieve list of collaborators for which stubs should be downloaded</li></ul></div></li></ul></div><p>This is the initial approach that can be easily changed in the future.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_can_i_modify_this_to_reuse_in_my_project" href="#_can_i_modify_this_to_reuse_in_my_project"></a>4.2.3&nbsp;Can I modify this to reuse in my project?</h3></div></div></div><p>Sure! It&#8217;s open-source! The important thing is that the core part of the logic is written in
Bash scripts. That way, in the majority of cases, you could change only the bash scripts without changing the
whole pipeline. <a class="link" href="https://github.com/spring-cloud/spring-cloud-pipelines/tree/master/common/src/main/bash" target="_top">You can check out the scripts here.</a></p><p>Furthermore, if you only want to customize a particular function under <code class="literal">common/src/main/bash</code>, you can provide your own
function under <code class="literal">common/src/main/bash/&lt;some custom identifier&gt;</code> where <code class="literal">&lt;some custom identifier&gt;</code> is equal to the value of
the <code class="literal">CUSTOM_SCRIPT_IDENTIFIER</code> environment variable. For more on this technique, see
<a class="link" href="../common/README.xml#Override specific project type pipeline functions" target="_top">Override specific project type pipeline functions</a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_i_ran_out_of_resources" href="#_i_ran_out_of_resources"></a>4.2.4&nbsp;I ran out of resources!!</h3></div></div></div><p><a name="resources" href="#resources"></a> When deploying the app to stage or prod you can get an exception <code class="literal">Insufficient resources</code>. The way to
 solve it is to kill some apps from test / stage env. To achieve that just call</p><pre class="programlisting">cf target -o pcfdev-org -s pcfdev-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>
cf stop github-webhook
cf stop github-eureka
cf stop stubrunner</pre><p>You can also execute <code class="literal">./tools/cf-helper.sh kill-all-apps</code> that will remove
all demo-related apps deployed to PCF dev.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_the_rollback_step_fails_due_to_missing_jar" href="#_the_rollback_step_fails_due_to_missing_jar"></a>4.2.5&nbsp;The rollback step fails due to missing JAR ?!</h3></div></div></div><p>You must have pushed some tags and have removed the Artifactory volume that
contained them. To fix this, just remove the tags</p><pre class="programlisting">git tag -l | xargs -n <span class="hl-number">1</span> git push --delete origin</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_can_i_see_the_output_of_a_job_from_the_terminal" href="#_can_i_see_the_output_of_a_job_from_the_terminal"></a>4.2.6&nbsp;Can I see the output of a job from the terminal?</h3></div></div></div><p>Yes! Assuming that pieline name is <code class="literal">github-webhook</code> and job name is <code class="literal">build-and-upload</code> you can running</p><pre class="programlisting">fly watch --job github-webhook/build-and-upload -t docker</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_i_clicked_the_job_and_it_s_constantly_pending" href="#_i_clicked_the_job_and_it_s_constantly_pending"></a>4.2.7&nbsp;I clicked the job and it&#8217;s constantly pending&#8230;&#8203;</h3></div></div></div><p>Don&#8217;t worry&#8230;&#8203; most likely you&#8217;ve just forgotten to click the <code class="literal">play</code> button to
unpause the pipeline. Click to the top left, expand the list of pipelines and click
the <code class="literal">play</code> button next to <code class="literal">github-webhook</code>.</p><p>Another problem that might occur is that you need to have the <code class="literal">version</code> branch.
Concourse will wait for the <code class="literal">version</code> branch to appear in your repo. So in order for
the pipeline to start ensure that when doing some git operations you haven&#8217;t
forgotten to create / copy the <code class="literal">version</code> branch too.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_the_route_is_already_in_use" href="#_the_route_is_already_in_use"></a>4.2.8&nbsp;The route is already in use</h3></div></div></div><p>If you play around with Jenkins / Concourse you might end up with the routes occupied</p><pre class="programlisting">Using route github-webhook-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>.local.pcfdev.io
Binding github-webhook-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>.local.pcfdev.io to github-webhook...
FAILED
The route github-webhook-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>.local.pcfdev.io is already in use.</pre><p>Just delete the routes</p><pre class="programlisting">yes | cf delete-route local.pcfdev.io -n github-webhook-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>
yes | cf delete-route local.pcfdev.io -n github-eureka-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>
yes | cf delete-route local.pcfdev.io -n stubrunner-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>
yes | cf delete-route local.pcfdev.io -n github-webhook-stage
yes | cf delete-route local.pcfdev.io -n github-eureka-stage
yes | cf delete-route local.pcfdev.io -n github-webhook-prod
yes | cf delete-route local.pcfdev.io -n github-eureka-prod</pre><p>You can also execute the <code class="literal">./tools/cf-helper.sh delete-routes</code></p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_i_m_unauthorized_to_deploy_infrastructure_jars" href="#_i_m_unauthorized_to_deploy_infrastructure_jars"></a>4.2.9&nbsp;I&#8217;m unauthorized to deploy infrastructure jars</h3></div></div></div><p>Most likely you&#8217;ve forgotten to update your local <code class="literal">settings.xml</code> with the Artifactory&#8217;s
setup. Check out <a class="link" href="">this section of the docs and update your <code class="literal">settings.xml</code></a>.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="multi__project_opinions.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="multi__jenkins_pipeline_common.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">3.&nbsp;Project opinions&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="multi_spring-cloud-pipelines.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;5.&nbsp;Jenkins Pipeline (Common)</td></tr></table></div></body></html>